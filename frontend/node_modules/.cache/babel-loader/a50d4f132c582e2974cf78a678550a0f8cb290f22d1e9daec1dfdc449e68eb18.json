{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\inava\\\\online-game\\\\frontend\\\\src\\\\App.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$(),\n  _s5 = $RefreshSig$(),\n  _s6 = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';\nimport { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, arrayUnion, arrayRemove, serverTimestamp, getDocs, deleteField, increment } from 'firebase/firestore';\nimport PlayerProfile from './PlayerProfile';\n\n// Firebase configuration from environment variables\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst firebaseConfig = JSON.parse(process.env.REACT_APP_FIREBASE_CONFIG || '{}');\nconst appId = process.env.REACT_APP_ID || 'default-app-id';\n\n// Initialize Firebase outside the component to avoid re-initialization\nconst app = initializeApp(firebaseConfig);\nconst db = getFirestore(app);\nconst auth = getAuth(app);\n\n// Helper for generating unique IDs (not cryptographically secure, but fine for game items)\nconst generateId = () => Math.random().toString(36).substring(2, 11);\n\n// Pre-defined game data\nconst PROMPT_CARDS = {\n  \"Red Flag or Relationship Goal?\": [],\n  // This will now be dynamically generated\n  \"Love, Laugh, or Leave?\": [{\n    type: \"fill\",\n    pillar: \"Boundaries\",\n    text: \"My date set a clear boundary by stating they wouldn't discuss anything before __________________.\"\n  }, {\n    type: \"fill\",\n    pillar: \"Communication\",\n    text: \"I knew there would be communication challenges when their opening line was, 'So, do you believe in __________________?'\"\n  }, {\n    type: \"fill\",\n    pillar: \"Respect\",\n    text: \"My date showed a shocking lack of respect when they started __________________ mid-conversation.\"\n  }, {\n    type: \"thisSoundsLike\",\n    pillar: \"Compromise\",\n    text: \"This sounds like... someone who, on a first date, orders for both of you and then says, 'No compromise on the appetizers!'\"\n  }, {\n    type: \"fill\",\n    pillar: \"Boundaries\",\n    text: \"The biggest red flag on our first date was when they instantly started talking about __________________.\"\n  }, {\n    type: \"fill\",\n    pillar: \"Communication\",\n    text: \"Their idea of 'getting to know you' involved asking about my __________________.\"\n  }, {\n    type: \"fill\",\n    pillar: \"Respect\",\n    text: \"I lost all respect for them when they pulled out a __________________ at the table.\"\n  }, {\n    type: \"thisSoundsLike\",\n    pillar: \"Boundaries\",\n    text: \"This sounds like... someone who brings their ex to a first date as a 'wingman'.\"\n  }, {\n    type: \"image_judgment\",\n    pillar: \"Boundaries\",\n    text: \"What's your red flag reaction to this scene?\",\n    ai_prompt_description: \"A photo of a person setting up a large, elaborate, and overly aggressive 'no trespassing' sign with barbed wire around a small, innocent-looking flower bed.\"\n  }]\n};\nconst ANSWER_CARDS = [\"a pet rock named 'Gary'\", \"my extensive collection of toenail clippings\", \"the concept of personal hygiene\", \"a five-hour interpretive dance\", \"my imaginary friend, Bartholomew\", \"the meaning of life, according to a squirrel\", \"their ex's entire family tree\", \"a spontaneous trip to the moon\", \"a heated debate about flat earth theories\", \"my obsession with competitive eating\", \"the ghost of my past relationship\", \"a really bad karaoke performance\", \"a detailed PowerPoint presentation on my insecurities\", \"my unique collection of lint\", \"a crying baby simulator\", \"the sound of a kazoo orchestra\", \"their unedited diary entries from middle school\", \"a sock puppet show\", \"the recipe for my grandma's infamous fruitcake\", \"a detailed analysis of my dream journal\", \"their pet goldfish\", \"a surprise visit from a mariachi band\", \"a 30-page manifesto on why cats are superior to dogs\", \"my crippling fear of ducks\", \"a life-sized cardboard cutout of myself\", \"the exact moment I realized I was allergic to gluten\", \"my collection of antique staplers\", \"a detailed explanation of quantum physics\", \"their personal alien abduction story\", \"a single, lonely potato\", \"the dark secrets of my childhood treehouse\", \"my profound love for glitter\", \"a dramatic re-enactment of my last dentist visit\", \"a squirrel dressed as a tiny chef\", \"my secret talent for burping the alphabet backwards\", \"a miniature alpaca farm\", \"the lingering smell of old gym socks\", \"my deep philosophical thoughts on cheese\", \"a very aggressive snail\", \"a conspiracy theory involving garden gnomes\", \"my questionable fashion choices from the 90s\", \"the universal language of farts\", \"a spontaneous opera performance\", \"my collection of rare, vintage sporks\", \"the exact number of hairs on my head\", \"a detailed map of my internal organs\", \"my uncanny ability to predict the weather with my knee\", \"a flock of angry pigeons\", \"my personal brand of awkward silence\", \"a very confused mime\", \"the entire script of a terrible B-movie\", \"a deep dive into celebrity gossip from 2003\", \"my most embarrassing childhood story, told in interpretive dance\", \"a rogue tumbleweed\", \"my collection of forgotten dreams\", \"a perpetually confused stare\", \"the subtle art of passive aggression\", \"a commitment to never folding laundry again\", \"the true identity of Santa Claus\", \"a never-ending loop of elevator music\", \"my inability to tell left from right\", \"a lifetime supply of questionable advice\", \"the secret to perfect toast\", \"a spontaneous act of kindness towards a pigeon\", \"my irrational fear of balloons\", \"a detailed budget of my impulse purchases\", \"the surprising history of garden hoses\", \"my unwavering dedication to napping\", \"a profound appreciation for mundane objects\", \"my personal record for most consecutive sneezes\", \"a hidden talent for imitating barnyard animals\", \"the shocking truth about socks\", \"my unwavering belief in unicorns\", \"a detailed analysis of my coffee preferences\", \"the silent language of eyebrow raises\", \"a deep philosophical debate about condiments\", \"my surprising expertise in competitive napping\", \"the existential dread of a Monday morning\", \"a profound understanding of cat psychology\", \"my secret stash of emergency chocolate\", \"the art of graceful awkwardness\", \"a detailed plan for world domination (starting with my pantry)\", \"my most cherished collection of bottle caps\", \"the subtle nuances of air guitar\", \"a profound appreciation for bad puns\", \"my impressive ability to procrastinate creatively\", \"the surprising comfort of mismatched socks\", \"a detailed study of dust bunnies\", \"my personal philosophy on the optimal way to butter toast\", \"the quiet rebellion of untamed hair\", \"a deep contemplation of the universe while staring at a ceiling fan\", \"my unwavering commitment to collecting novelty erasers\", \"the dramatic flair of a well-timed eye-roll\"];\n\n// Component for displaying temporary messages/modals instead of alerts\nconst MessageModal = ({\n  message,\n  onClose\n}) => {\n  if (!message) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-lg p-6 shadow-xl max-w-sm w-full text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl font-semibold mb-4 text-gray-800\",\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onClose,\n        className: \"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105\",\n        children: \"OK\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 9\n  }, this);\n};\n_c = MessageModal;\nconst RED_FLAG_TITLES = {\n  0: {\n    title: \"Soulmate Status/ Certified Lover\",\n    description: \"Congratulations! You are pure relationship gold. Smooth sailing, good vibes, and probably a waiting list for dates.\"\n  },\n  10: {\n    title: \"Almost Perfect / Just a Vibe\",\n    description: \"A few tiny quirks, but nothing a little communication can't handle. You're basically custom-ordered for a healthy partnership.\"\n  },\n  20: {\n    title: \"The Minor Tune-Up / Good to Go, Mostly\",\n    description: \"You've got some minor glitches, but nothing that derails the whole operation. A little self-awareness and effort, and you're golden.\"\n  },\n  30: {\n    title: \"The 'Work In Progress' / Relationship Project\",\n    description: \"Okay, we see some areas for improvement. You're still worth the effort, but don't forget the manual for emotional intelligence.\"\n  },\n  40: {\n    title: \"Proceed with Caution / Yellow Light\",\n    description: \"The warning signs are starting to flash. There's potential, but someone's gonna need a hard hat and a lot of patience to build something solid here.\"\n  },\n  50: {\n    title: \"Flip a Coin/ Mixed Bag\",\n    description: \"You're a true enigma. Half a dream, half a nightmare. This relationship is gonna keep everyone guessing. Strap in!\"\n  },\n  60: {\n    title: \"Danger Zone / Enter at Your Own Risk\",\n    description: \"The red flags are starting to outnumber the green ones. This connection might come with more drama than a reality TV show.\"\n  },\n  70: {\n    title: \"High Maintenance, Low Reward / The Tempting Trap\",\n    description: \"Oh, you're charismatic alright, but behind that charm, there are some serious issues lurking. It's like a beautiful car with no brakes.\"\n  },\n  80: {\n    title: \"Warning Sign Warrior / Full Steam Ahead to Chaos\",\n    description: \"You're not just waving red flags; you've got a whole parade of them. This relationship needs a professional, or an escape plan.\"\n  },\n  90: {\n    title: \"RUN! / Evacuate Immediately\",\n    description: \"This isn't dating; it's an extreme sport. Every interaction is a potential landmine. Get out. Now.\"\n  },\n  100: {\n    title: \"The Walking Red Flag / Relationship Kryptonite\",\n    description: \"You are the embodiment of every cautionary tale. A master class in 'what not to do.' Stay far, far away for everyone's safety.\"\n  }\n};\n\n// Rename KRIYA_ADS to POPUP_ADS\nconst POPUP_ADS = [{\n  title: \"Kriya Botanicals - Nourish Your Roots!\",\n  image: \"https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-6/473014145_1022672133212383_7455427243637921771_n.jpg?_nc_cat=111&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=xDgn4zdguJIQ7kNvwGKd2EK&_nc_oc=AdlKTmywN5e6dNvjc-yH_7PTAt12RPrNgqKMqLvT7dmfz0T0vyMRNeNVJwVjvxCroYw&_nc_zt=23&_nc_ht=scontent-mia3-1.xx&_nc_gid=1g-FyU6O3VDFy1DvpHwpIQ&oh=00_AfO1xUz6MGVrsMqNnc2j7dDQbCK7_5gHvU5ea6G2gWpHUA&oe=685F16E9\",\n  // Example placeholder\n  description: \"Experience the power of nature with Kriya Botanicals natural hair products. Hydrate, strengthen, and shine—naturally! Try our best-selling leave-in conditioner today.\"\n}, {\n  title: \"Kriya Botanicals - Curls That Wow!\",\n  image: \"https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-6/486493494_10161139828952543_6107835121073011412_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=833d8c&_nc_ohc=Tq5GlDW58V0Q7kNvwE80yCw&_nc_oc=Adli1caSZyzmwB3bfqDa3P5OWq2NZ6vLvvpDSdiuat-BjOWQ5a75T0YB75z8GwuIO0E&_nc_zt=23&_nc_ht=scontent-mia3-1.xx&_nc_gid=4KS3SwcRA5uIpc_UOm_AIw&oh=00_AfOFchd-nFXsXQjFWqG4XUI5190aEb7tKHfCFMRQEYBgog&oe=685F49EA\",\n  description: \"Unleash your curls with Kriya Botanicals. Our botanical blends define, detangle, and dazzle. Because your hair deserves the best!\"\n}, {\n  title: \"Kriya Botanicals - Pure, Plant-Powered Beauty!\",\n  image: \"https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=600&q=80https://scontent-mia3-3.xx.fbcdn.net/v/t39.30808-6/470148513_18467575291005150_3673084829007527660_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=127cfc&_nc_ohc=UmuJoiF97esQ7kNvwHfL6Nj&_nc_oc=AdnjIysxZXN4E67SZMhW5Rh9rhW5fo5Q775XdrvXbhmCkAf0odlt5EZ3Nz12_L-VlmI&_nc_zt=23&_nc_ht=scontent-mia3-3.xx&_nc_gid=OavS8Zp0_-Z8vECDAJM5XQ&oh=00_AfMi6EA_D2JZLiWekipC6JII-fplbOXpldIS2Fdmb-NpFQ&oe=685F272E\",\n  description: \"Go green with your routine! Kriya Botanicals uses only the purest plant ingredients for healthy, happy hair. Discover your new favorite today.\"\n}];\n\n// Main App Component\nfunction App() {\n  _s();\n  const [userId, setUserId] = useState(null);\n  const [currentPage, setCurrentPage] = useState('home');\n  const [previousPage, setPreviousPage] = useState('home');\n  const [gameId, setGameId] = useState(null);\n  const [gameData, setGameData] = useState(null);\n  const [message, setMessage] = useState(null);\n  const [isAuthReady, setIsAuthReady] = useState(false);\n  const [isLoadingImage, setIsLoadingImage] = useState(false); // For host loading state\n  const [playerName, setPlayerName] = useState(''); // New state for player nickname\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [user, setUser] = useState(null);\n\n  // Define isHost at the top level so it's available in all handlers\n  const isHost = gameData && gameData.hostId === userId;\n\n  // Move generateRedFlagQuestion to App scope so it's available everywhere\n  const generateRedFlagQuestion = async () => {\n    try {\n      const response = await fetch('http://localhost:3001/api/generate-red-flag-question', {\n        method: 'POST'\n      });\n      if (!response.ok) throw new Error('Failed to generate question');\n      return await response.json();\n    } catch (error) {\n      console.error('AI backend failed, using fallback question:', error);\n      // Fallback question and choices\n      return {\n        type: 'scenario_vote',\n        text: \"Your partner insists on bringing their pet iguana to every date. What's your move?\",\n        choices: {\n          a: \"That's a dealbreaker. I'm not sharing my fries with a lizard.\",\n          b: \"Honestly, that's kind of awesome. Can I get it a tiny hat?\",\n          c: \"I have so many questions, but I'm here for the chaos.\",\n          d: \"As long as the iguana doesn't judge my karaoke, we're good.\"\n        },\n        pillar: \"Relationship Riddles\"\n      };\n    }\n  };\n\n  // Auth state listener and initial sign-in logic\n  useEffect(() => {\n    const SESSION_USER_ID_KEY = 'redFlagsGameTempUserId';\n    const unsubscribe = onAuthStateChanged(auth, async currentUser => {\n      const initialAuthToken = process.env.REACT_APP_INITIAL_AUTH_TOKEN;\n      if (initialAuthToken) {\n        // If an initial auth token is provided (e.g., from the Canvas environment)\n        // Use Firebase authentication with the provided token.\n        if (!currentUser) {\n          try {\n            await signInWithCustomToken(auth, initialAuthToken);\n          } catch (error) {\n            console.error(\"Firebase Auth Error with custom token:\", error);\n            setMessage(`Authentication failed: ${error.message}. Please refresh.`);\n          }\n        }\n        // Once authenticated, set the user and their UID from Firebase.\n        if (auth.currentUser) {\n          setUserId(auth.currentUser.uid);\n          // Set default player name if not already set, or load from storage\n          if (!playerName) {\n            setPlayerName(`Player ${auth.currentUser.uid.substring(0, 4)}`);\n          }\n        }\n      } else {\n        // If no initial auth token (e.g., in a standalone browser tab for testing)\n        // Generate and use a temporary, session-based user ID.\n        let tempUserId = sessionStorage.getItem(SESSION_USER_ID_KEY);\n        if (!tempUserId) {\n          tempUserId = `guest_${crypto.randomUUID()}`; // Generate a unique ID\n          sessionStorage.setItem(SESSION_USER_ID_KEY, tempUserId);\n          console.log(\"Generated new session userId:\", tempUserId);\n        } else {\n          console.log(\"Reusing session userId:\", tempUserId);\n        }\n        setUserId(tempUserId); // Use the session ID as the userId\n        // Set default player name for guest\n        if (!playerName) {\n          setPlayerName(`Player ${tempUserId.substring(0, 5)}`);\n        }\n      }\n      setIsAuthReady(true); // Auth listener has completed its initial check or temp ID is set\n    });\n    return () => unsubscribe();\n  }, [playerName]); // Added playerName to dependencies to prevent re-rendering issues\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, firebaseUser => {\n      setUser(firebaseUser);\n    });\n    return () => unsubscribe();\n  }, []);\n\n  // Firebase game data listener\n  useEffect(() => {\n    if (!gameId || !isAuthReady || !userId) return; // Ensure auth and user are ready\n\n    const gameDocRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\n    const unsubscribeGame = onSnapshot(gameDocRef, async docSnap => {\n      if (docSnap.exists()) {\n        const newData = {\n          id: docSnap.id,\n          ...docSnap.data()\n        };\n\n        // Use functional update to compare with previous state without causing re-subscription\n        setGameData(prevData => {\n          var _newData$prompts, _newData$prompts2;\n          // If a new image judgment prompt was just set by the host, generate the image\n          if (userId === newData.hostId && newData.status === 'submission' && ((_newData$prompts = newData.prompts[newData.currentRound - 1]) === null || _newData$prompts === void 0 ? void 0 : _newData$prompts.type) === 'image_judgment' && !((_newData$prompts2 = newData.prompts[newData.currentRound - 1]) !== null && _newData$prompts2 !== void 0 && _newData$prompts2.imageUrl) && ((prevData === null || prevData === void 0 ? void 0 : prevData.currentRound) !== newData.currentRound || (prevData === null || prevData === void 0 ? void 0 : prevData.status) !== 'submission')) {\n            setIsLoadingImage(true);\n            generateImageForPrompt(newData.prompts[newData.currentRound - 1].ai_prompt_description).then(imageUrl => {\n              updateDoc(gameDocRef, {\n                [`prompts.${newData.currentRound - 1}.imageUrl`]: imageUrl,\n                isLoadingImage: false\n              });\n              setIsLoadingImage(false);\n            });\n          }\n          return newData; // Update the state with the new data\n        });\n\n        // Navigate based on game status\n        if (newData.status === 'submission' || newData.status === 'voting') {\n          setCurrentPage('game');\n        } else if (newData.status === 'round_end') {\n          setCurrentPage('leaderboard');\n        } else if (newData.status === 'game_over') {\n          setCurrentPage('winner');\n        } else if (newData.status === 'lobby') {\n          setCurrentPage('lobby');\n        }\n      } else {\n        console.error(\"Game document does not exist!\");\n        setGameId(null);\n        setGameData(null);\n        setCurrentPage('home');\n        showMessage(\"The game you were in no longer exists.\");\n      }\n    });\n    return () => unsubscribeGame();\n  }, [gameId, isAuthReady, userId]); // Correct dependency array, removed gameData\n\n  // Utility to generate image (placeholder)\n  const generateImageForPrompt = async promptDescription => {\n    console.log(\"Starting image generation for:\", promptDescription);\n    // This is a placeholder. In a real app, you would call your AI image model here.\n    // For now, we return a static placeholder image URL after a short delay.\n    await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate network delay\n    const placeholderUrl = `https://via.placeholder.com/400x300.png?text=${encodeURIComponent(promptDescription.substring(0, 30))}`;\n    console.log(\"Generated image URL:\", placeholderUrl);\n    return placeholderUrl;\n  };\n  const showMessage = msg => {\n    setMessage(msg);\n  };\n  const handleNextRound = async () => {\n    if (!isHost) return;\n    try {\n      const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\n      const nextRound = gameData.currentRound + 1;\n\n      // Always transition to winner if at or past maxRounds\n      if (nextRound > gameData.maxRounds || gameData.currentRound >= gameData.maxRounds) {\n        await updateDoc(gameRef, {\n          status: 'winner'\n        });\n        return;\n      }\n      let finalPrompts = [];\n      let finalMaxRounds = 10;\n      let promptHistory = gameData.promptHistory || [];\n      let finalPrompt;\n      if (gameData.category === \"Red Flag or Relationship Goal\") {\n        // For this mode, prompts are pre-generated. Just get the next one.\n        finalPrompt = gameData.prompts[nextRound - 1];\n        if (!finalPrompt) {\n          console.error(\"Could not find the next prompt for Red Flag mode.\");\n          await updateDoc(gameRef, {\n            status: 'winner'\n          });\n          return;\n        }\n      } else {\n        // For other modes, generate a new prompt dynamically\n        const promptCardsForCategory = PROMPT_CARDS[gameData.category] || [];\n        if (promptCardsForCategory.length === 0) {\n          showMessage(\"No prompts available for this category.\");\n          return;\n        }\n        finalPrompt = getRandomPrompt(promptCardsForCategory, promptHistory);\n        promptHistory = [...promptHistory, finalPrompt.text];\n        finalMaxRounds = Math.min(10, promptCardsForCategory.length);\n      }\n\n      // Reset player states for the new round\n      const updatedPlayers = {};\n      let availableCards = [...ANSWER_CARDS]; // For replenishment logic (only used for Red Flag/Looks Like)\n\n      for (const pId in gameData.players) {\n        const player = gameData.players[pId];\n        let currentHand = player.hand || [];\n        // Only replenish hands for Red Flag or Relationship Goal and Looks Like\n        if (gameData.category === \"Red Flag or Relationship Goal\" || gameData.category === \"Looks Like\") {\n          const cardsNeeded = 10 - currentHand.length;\n          if (cardsNeeded > 0) {\n            const shuffledDeck = shuffleArray([...availableCards]);\n            const newCards = shuffledDeck.slice(0, cardsNeeded);\n            currentHand.push(...newCards);\n          }\n        }\n        // For all other categories, do NOT replenish hand\n        updatedPlayers[pId] = {\n          ...player,\n          hand: currentHand,\n          hasSubmitted: false,\n          hasVoted: false\n        };\n      }\n      const updatePayload = {\n        status: 'submission',\n        currentRound: nextRound,\n        players: updatedPlayers,\n        submittedAnswers: {},\n        playerChoices: {},\n        votes: {},\n        roundResults: deleteField(),\n        currentWinningSubmission: null,\n        isLoadingImage: finalPrompt.type === 'image_judgment'\n      };\n\n      // Only update prompts if they are not pre-loaded\n      if (gameData.category !== \"Red Flag or Relationship Goal\") {\n        updatePayload.prompts = [...gameData.prompts, finalPrompt];\n        updatePayload.promptHistory = promptHistory;\n      }\n      await updateDoc(gameRef, updatePayload);\n    } catch (error) {\n      console.error(\"Error advancing round:\", error);\n      showMessage(`Error advancing round: ${error.message}`);\n    }\n  };\n  const handlePlayAgain = async () => {\n    if (gameData.hostId !== userId) {\n      showMessage(\"Only the host can start a new game.\");\n      return;\n    }\n    try {\n      const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\n\n      // Reset player states\n      const resetPlayers = {\n        ...gameData.players\n      };\n      for (const pId in resetPlayers) {\n        resetPlayers[pId] = {\n          ...resetPlayers[pId],\n          score: 0,\n          hand: [],\n          hasSubmitted: false,\n          hasVoted: false,\n          totalHearts: 0,\n          totalRedFlags: 0\n        };\n      }\n      await updateDoc(gameRef, {\n        status: 'lobby',\n        currentRound: 0,\n        maxRounds: 10,\n        prompts: [],\n        promptHistory: [],\n        submittedAnswers: {},\n        playerChoices: {},\n        votes: {},\n        roundResults: deleteField(),\n        currentWinningSubmission: null,\n        isLoadingImage: false,\n        players: resetPlayers,\n        category: Object.keys(PROMPT_CARDS)[0] // Reset to default category\n      });\n      // The onSnapshot listener will automatically handle the page transition to 'lobby'\n    } catch (error) {\n      console.error(\"Error restarting game:\", error);\n      showMessage(\"Failed to restart the game.\");\n    }\n  };\n\n  // Room code display (top left)\n  const renderRoomCode = () => {\n    if (gameData && gameData.gameCode) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"fixed top-2 left-2 bg-gray-800 text-white px-4 py-2 rounded shadow-lg z-50\",\n        children: [\"Room Code: \", gameData.gameCode]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 427,\n        columnNumber: 17\n      }, this);\n    }\n    return null;\n  };\n\n  // Render logic based on currentPage\n  const renderPage = () => {\n    switch (currentPage) {\n      case 'home':\n        return /*#__PURE__*/_jsxDEV(HomePage, {\n          setCurrentPage: setCurrentPage,\n          setGameId: setGameId,\n          userId: userId,\n          showMessage: showMessage,\n          playerName: playerName,\n          setPlayerName: setPlayerName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 24\n        }, this);\n      case 'lobby':\n        return /*#__PURE__*/_jsxDEV(LobbyPage, {\n          gameData: gameData,\n          gameId: gameId,\n          userId: userId,\n          showMessage: showMessage,\n          generateRedFlagQuestion: generateRedFlagQuestion,\n          isHost: isHost\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 24\n        }, this);\n      case 'game':\n        return /*#__PURE__*/_jsxDEV(GamePage, {\n          gameData: gameData,\n          gameId: gameId,\n          userId: userId,\n          showMessage: showMessage,\n          isLoadingImage: isLoadingImage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 24\n        }, this);\n      // Pass isLoadingImage\n      case 'leaderboard':\n        return /*#__PURE__*/_jsxDEV(LeaderboardPage, {\n          gameData: gameData,\n          userId: userId,\n          gameId: gameId,\n          showMessage: showMessage,\n          handleNextRound: handleNextRound\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 24\n        }, this);\n      // Adjusted to use updated handleNextRound via prop\n      case 'winner':\n        return /*#__PURE__*/_jsxDEV(WinnerPage, {\n          gameData: gameData,\n          userId: userId,\n          onPlayAgain: handlePlayAgain,\n          showMessage: showMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 24\n        }, this);\n      // Pass showMessage for modal\n      default:\n        return /*#__PURE__*/_jsxDEV(HomePage, {\n          setCurrentPage: setCurrentPage,\n          setGameId: setGameId,\n          userId: userId,\n          showMessage: showMessage,\n          playerName: playerName,\n          setPlayerName: setPlayerName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 449,\n          columnNumber: 24\n        }, this);\n    }\n  };\n  if (!isAuthReady) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-800 via-pink-600 to-red-500 text-white font-inter\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-3xl animate-pulse\",\n        children: \"Loading game...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 456,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 455,\n      columnNumber: 13\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gradient-to-br from-purple-800 via-pink-600 to-red-500 text-white font-inter flex flex-col items-center justify-center p-4 relative\",\n    children: [renderRoomCode(), currentPage !== 'profile' && /*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-5xl md:text-6xl font-extrabold text-center mb-8 drop-shadow-lg leading-tight\",\n      children: gameData && gameData.category ? gameData.category : 'Red Flags & Relationship Goals'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 17\n    }, this), renderPage()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 462,\n    columnNumber: 9\n  }, this);\n}\n\n// HomePage Component\n_s(App, \"JdGZPZJG39MUhlCUmP5eiHn92SI=\");\n_c2 = App;\nconst HomePage = ({\n  setCurrentPage,\n  setGameId,\n  userId,\n  showMessage,\n  playerName,\n  setPlayerName\n}) => {\n  _s2();\n  const [joinCode, setJoinCode] = useState('');\n  const handleCreateGame = async () => {\n    if (!playerName.trim()) {\n      showMessage(\"Please enter your nickname.\");\n      return;\n    }\n    try {\n      const gameCode = Math.random().toString(36).substring(2, 8).toUpperCase();\n      const initialPlayers = {};\n      initialPlayers[userId] = {\n        id: userId,\n        name: playerName.trim(),\n        score: 0,\n        isHost: true,\n        hand: [],\n        hasSubmitted: false,\n        hasVoted: false,\n        totalRedFlags: 0,\n        totalHearts: 0\n      };\n      const newGameRef = await addDoc(collection(db, `artifacts/${appId}/public/data/games`), {\n        hostId: userId,\n        category: \"Can We Talk?\",\n        mode: \"canWeTalk\",\n        currentRound: 0,\n        rounds: [],\n        status: 'lobby',\n        players: initialPlayers,\n        gameCode: gameCode,\n        createdAt: serverTimestamp()\n      });\n      setGameId(newGameRef.id);\n      setCurrentPage('lobby');\n      showMessage(`Game created! Share code: ${gameCode}`);\n    } catch (error) {\n      console.error(\"Error creating game:\", error);\n      showMessage(\"Failed to create game. Please try again.\");\n    }\n  };\n  const handleJoinGame = async () => {\n    if (!playerName.trim()) {\n      showMessage(\"Please enter your nickname.\");\n      return;\n    }\n    if (!joinCode) {\n      showMessage(\"Please enter a game code.\");\n      return;\n    }\n    try {\n      console.log(`Attempting to query Firestore for collection: artifacts/${appId}/public/data/games with gameCode: ${joinCode.toUpperCase()}`); // More detailed debugging log\n      const q = query(collection(db, `artifacts/${appId}/public/data/games`), where(\"gameCode\", \"==\", joinCode.toUpperCase()));\n      const querySnapshot = await getDocs(q);\n      console.log(\"Query Snapshot empty:\", querySnapshot.empty); // Debugging log\n\n      if (!querySnapshot.empty) {\n        const gameDoc = querySnapshot.docs[0];\n        const gameData = gameDoc.data();\n        const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameDoc.id);\n\n        // Allow joining at any status\n        if (gameData.players[userId]) {\n          showMessage(\"You are already in this game.\");\n          // Route to the correct page based on game status\n          if (gameData.status === 'submission' || gameData.status === 'voting') {\n            setCurrentPage('game');\n          } else if (gameData.status === 'round_end') {\n            setCurrentPage('leaderboard');\n          } else if (gameData.status === 'game_over') {\n            setCurrentPage('winner');\n          } else {\n            setCurrentPage('lobby');\n          }\n          setGameId(gameDoc.id);\n          return;\n        }\n\n        // Give initial cards\n        const playerHand = shuffleArray([...ANSWER_CARDS]).slice(0, 10);\n        await updateDoc(gameRef, {\n          [`players.${userId}`]: {\n            id: userId,\n            // Added unique ID for the player object\n            name: playerName.trim(),\n            // Use custom player name\n            score: 0,\n            isHost: false,\n            hand: playerHand,\n            hasSubmitted: false,\n            hasVoted: false,\n            totalRedFlags: 0,\n            totalHearts: 0\n          }\n        });\n        setGameId(gameDoc.id);\n        // Route to the correct page based on game status\n        if (gameData.status === 'submission' || gameData.status === 'voting') {\n          setCurrentPage('game');\n        } else if (gameData.status === 'round_end') {\n          setCurrentPage('leaderboard');\n        } else if (gameData.status === 'game_over') {\n          setCurrentPage('winner');\n        } else {\n          setCurrentPage('lobby');\n        }\n        showMessage(`Joined game ${joinCode}!`);\n      } else {\n        showMessage(\"Invalid game code.\");\n      }\n    } catch (error) {\n      console.error(\"Error joining game:\", error);\n      showMessage(\"Failed to join game. Please try again.\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Enter your nickname\",\n      value: playerName,\n      onChange: e => setPlayerName(e.target.value),\n      className: \"w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4 text-center\",\n      maxLength: \"20\" // Limit nickname length\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleCreateGame,\n      className: \"w-full mb-4 bg-gradient-to-r from-blue-500 to-teal-400 hover:from-blue-600 hover:to-teal-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\",\n      children: \"Create New Game\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 603,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-200 mb-2\",\n        children: \"OR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Enter Game Code\",\n        value: joinCode,\n        onChange: e => setJoinCode(e.target.value),\n        className: \"w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-3 text-center uppercase\",\n        maxLength: \"6\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 611,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleJoinGame,\n        className: \"w-full bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\",\n        children: \"Join Game\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 619,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 609,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-sm text-gray-300 mt-4\",\n      children: \"Minimum 2 players needed to start a game.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 626,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 594,\n    columnNumber: 9\n  }, this);\n};\n\n// LobbyPage Component\n_s2(HomePage, \"42J/m0wXRcmRnUDiHpTJ/GtKQxM=\");\n_c3 = HomePage;\nconst LobbyPage = ({\n  gameData,\n  gameId,\n  userId,\n  showMessage,\n  generateRedFlagQuestion,\n  isHost\n}) => {\n  _s3();\n  // Move useState to the top\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  // Add a more specific check to ensure gameData and its nested properties are loaded\n  if (!gameData || !gameData.hostId || !gameData.players) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-xl text-gray-200 animate-pulse\",\n      children: \"Loading lobby...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 640,\n      columnNumber: 16\n    }, this);\n  }\n  const playersInLobby = Object.values(gameData.players).sort((a, b) => a.name.localeCompare(b.name));\n  const handleCategoryChange = async e => {\n    if (!isHost) return;\n    const newCategory = e.target.value;\n    try {\n      const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\n      await updateDoc(gameRef, {\n        category: newCategory\n      });\n    } catch (error) {\n      console.error(\"Error updating category:\", error);\n      showMessage(\"Failed to update category.\");\n    }\n  };\n  const handleStartGame = async () => {\n    if (!isHost) return;\n    const playersInGame = Object.values(gameData.players);\n    if (playersInGame.length < 1) {\n      // Allows solo testing\n      showMessage(\"You need at least 1 player to start the game.\");\n      return;\n    }\n    setIsGenerating(true);\n    try {\n      var _finalPrompts$;\n      const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\n      let finalPrompts = [];\n      let finalMaxRounds = 10;\n      let promptHistory = [];\n      if (gameData.category === \"Red Flag or Relationship Goal\") {\n        for (let i = 0; i < 10; i++) {\n          const newPrompt = await generateRedFlagQuestion();\n          finalPrompts.push(newPrompt);\n        }\n        finalMaxRounds = finalPrompts.length;\n      } else {\n        const promptCardsForCategory = PROMPT_CARDS[gameData.category] || [];\n        if (promptCardsForCategory.length === 0) {\n          showMessage(\"No prompts available for this category.\");\n          setIsGenerating(false);\n          return;\n        }\n        const initialPrompt = getRandomPrompt(promptCardsForCategory, []);\n        finalPrompts.push(initialPrompt);\n        finalMaxRounds = Math.min(10, promptCardsForCategory.length);\n      }\n      finalPrompts.forEach(p => promptHistory.push(p.text));\n\n      // Distribute unique hands to all players\n      let availableCards = [...ANSWER_CARDS];\n      const updatedPlayers = {\n        ...gameData.players\n      };\n      for (const pId in updatedPlayers) {\n        const hand = [];\n        // Ensure players always have 10 cards at the start of the game\n        for (let i = 0; i < 10; i++) {\n          if (availableCards.length === 0) {\n            // If pool runs low, replenish it with all ANSWER_CARDS shuffled\n            availableCards = shuffleArray([...ANSWER_CARDS]);\n            console.warn(\"Answer card pool replenished by reshuffling all cards during initial deal.\");\n          }\n          const cardIndex = Math.floor(Math.random() * availableCards.length);\n          hand.push(availableCards.splice(cardIndex, 1)[0]);\n        }\n        updatedPlayers[pId].hand = hand;\n        updatedPlayers[pId].hasSubmitted = false;\n        updatedPlayers[pId].hasVoted = false;\n      }\n      await updateDoc(gameRef, {\n        status: 'submission',\n        currentRound: 1,\n        maxRounds: finalMaxRounds,\n        prompts: finalPrompts,\n        promptHistory: promptHistory,\n        players: updatedPlayers,\n        playerChoices: {},\n        submittedAnswers: {},\n        votes: {},\n        isLoadingImage: ((_finalPrompts$ = finalPrompts[0]) === null || _finalPrompts$ === void 0 ? void 0 : _finalPrompts$.type) === 'image_judgment'\n      });\n    } catch (error) {\n      console.error(\"Error starting game:\", error);\n      showMessage(\"An error occurred while starting the game.\");\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-center p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text-4xl font-bold mb-4 text-white\",\n      children: \"Game Lobby\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 738,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-xl text-gray-200 mb-6\",\n      children: [\"Game Code: \", /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"font-bold text-yellow-300\",\n        children: gameData.gameCode\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 740,\n        columnNumber: 28\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 739,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-lg text-gray-200 mb-2 flex items-center justify-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"mr-2\",\n        children: \"Category:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 743,\n        columnNumber: 17\n      }, this), isHost ? /*#__PURE__*/_jsxDEV(\"select\", {\n        value: gameData.category,\n        onChange: handleCategoryChange,\n        className: \"p-2 rounded-lg bg-white bg-opacity-20 text-white font-semibold focus:outline-none focus:ring-2 focus:ring-blue-400\",\n        children: Object.keys(PROMPT_CARDS).map(cat => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: cat,\n          className: \"text-black\",\n          children: cat\n        }, cat, false, {\n          fileName: _jsxFileName,\n          lineNumber: 751,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 745,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"font-semibold text-pink-200\",\n        children: gameData.category\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 755,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 742,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-lg text-gray-200 mb-4\",\n      children: \"Players Connected:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 758,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      className: \"list-disc list-inside text-left mx-auto max-w-xs mb-8 text-gray-100\",\n      children: playersInLobby.map(player => /*#__PURE__*/_jsxDEV(\"li\", {\n        className: \"py-1\",\n        children: [player.name, \" \", player.isHost && \"(Host)\"]\n      }, player.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 761,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 759,\n      columnNumber: 13\n    }, this), isHost && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-6\",\n      children: isGenerating ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-2xl text-white animate-pulse\",\n          children: \"We are generating hilarious and problematic scenarios...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 770,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-400 mt-2\",\n          children: \"This might take a moment.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 771,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 769,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleStartGame,\n        disabled: !isHost || playersInLobby.length < 1,\n        className: \"w-full bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed\",\n        children: \"Start Game\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 774,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 767,\n      columnNumber: 17\n    }, this), !isHost && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-xl text-gray-300 italic\",\n      children: \"Waiting for host to start the game!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 785,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 737,\n    columnNumber: 9\n  }, this);\n};\n\n// GamePage Component\n_s3(LobbyPage, \"UwcDqC7CmUDXsdKWKaG4uXzzAaQ=\");\n_c4 = LobbyPage;\nconst GamePage = ({\n  gameData,\n  gameId,\n  userId,\n  showMessage,\n  isLoadingImage\n}) => {\n  // Pass isLoadingImage\n  if (!gameData || !gameData.prompts || gameData.prompts.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-xl text-gray-200\",\n      children: \"Waiting for game to start...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 794,\n      columnNumber: 16\n    }, this);\n  }\n  const currentPrompt = gameData.prompts[gameData.currentRound - 1];\n  if (!currentPrompt) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-xl text-gray-200\",\n      children: \"Loading prompt data...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 799,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(GameRound, {\n    gameData: gameData,\n    gameId: gameId,\n    userId: userId,\n    showMessage: showMessage,\n    isLoadingImage: isLoadingImage\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 802,\n    columnNumber: 12\n  }, this); // Pass isLoadingImage\n};\n_c5 = GamePage;\nconst GamePrompt = ({\n  prompt,\n  gameData,\n  isLoadingImage\n}) => {\n  _s4();\n  // Receive isLoadingImage\n  const [imageUrl, setImageUrl] = useState(prompt.imageUrl);\n  const [isGeneratingImage, setIsGeneratingImage] = useState(false);\n  useEffect(() => {\n    if (prompt.category === 'Looks Like' && !imageUrl && prompt.pillar) {\n      setIsGeneratingImage(true);\n      fetch('/api/generate-relationship-image', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          pillar: prompt.pillar,\n          description: prompt.ai_prompt_description // send the full scenario\n        })\n      }).then(res => res.json()).then(data => {\n        setImageUrl(data.imageUrl);\n        setIsGeneratingImage(false);\n        // Optionally: update Firestore with the new imageUrl for this prompt\n      }).catch(() => setIsGeneratingImage(false));\n    }\n  }, [prompt, imageUrl]);\n  if (!prompt) return null;\n\n  // Show loading message if it's an image prompt AND host is currently generating it\n  if (prompt.type === 'image_judgment' && isLoadingImage || isGeneratingImage) {\n    // Check local loading state\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-3xl font-bold mb-4 text-white animate-pulse\",\n        children: \"Generating AI Image...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 840,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl text-gray-200\",\n        children: \"The host is creating a new visual prompt. Please wait.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 841,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 839,\n      columnNumber: 13\n    }, this);\n  }\n\n  // Guard: if prompt.text is undefined, show a fallback or handle image-only prompts\n  let promptContent;\n  if (prompt.category === 'Looks Like') {\n    // For Looks Like, do NOT display any prompt text or description\n    promptContent = null;\n  } else if (typeof prompt.text === 'string') {\n    promptContent = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-3xl md:text-4xl font-extrabold text-white leading-tight\",\n      dangerouslySetInnerHTML: {\n        __html: prompt.text.replace(/__________________/g, '<span class=\\\"text-pink-300 underline\\\">BLANK</span>')\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 852,\n      columnNumber: 25\n    }, this);\n  } else if ((prompt.type === 'image_judgment' || prompt.category === 'Looks Like') && prompt.ai_prompt_description) {\n    promptContent = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-2xl font-bold text-white mb-2\",\n      children: prompt.ai_prompt_description\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 856,\n      columnNumber: 25\n    }, this);\n  } else {\n    promptContent = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-2xl font-bold text-white mb-2\",\n      children: \"No prompt text available.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 858,\n      columnNumber: 25\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-center bg-white bg-opacity-20 rounded-xl p-4 md:p-6 shadow-xl w-full max-w-2xl border border-white border-opacity-30 mb-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-xl font-bold text-yellow-200 mb-2\",\n      children: prompt.pillar\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 863,\n      columnNumber: 13\n    }, this), promptContent, (prompt.type === 'image_judgment' || prompt.category === 'Looks Like') && imageUrl && /*#__PURE__*/_jsxDEV(\"img\", {\n      src: imageUrl,\n      alt: prompt.ai_prompt_description || prompt.pillar,\n      className: \"mt-4 rounded-lg shadow-lg mx-auto w-full max-w-md h-auto object-contain\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 866,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-4 text-lg text-gray-200\",\n      children: [\"Round \", gameData.currentRound, \" of \", gameData.maxRounds]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 868,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 862,\n    columnNumber: 9\n  }, this);\n};\n_s4(GamePrompt, \"8bq527Qlb3ccJeySFlXoklvSwRQ=\");\n_c6 = GamePrompt;\nconst GameRound = ({\n  gameData,\n  gameId,\n  userId,\n  showMessage,\n  isLoadingImage\n}) => {\n  _s5();\n  // Receive isLoadingImage\n  // Move all hooks to the top\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [customAnswer, setCustomAnswer] = useState('');\n  const [nominationData, setNominationData] = useState({\n    nominatedPlayerId: '',\n    justification: ''\n  });\n  const [selectedVote, setSelectedVote] = useState(null);\n  const [selectedChoice, setSelectedChoice] = useState(null); // For scenario_vote\n  const [isWritingCustom, setIsWritingCustom] = useState(false);\n  const [customScenarioAnswer, setCustomScenarioAnswer] = useState('');\n  const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\n  const currentPlayer = gameData.players[userId];\n  const {\n    players: allPlayers,\n    currentRound,\n    status,\n    prompts,\n    submittedAnswers: submittedAnswersObj\n  } = gameData;\n  const currentPrompt = prompts[currentRound - 1]; // Access the correct prompt based on round\n  const isHost = gameData.hostId === userId;\n  const submittedAnswers = Object.values(submittedAnswersObj || {}).sort((a, b) => {\n    var _a$submittedAt, _b$submittedAt;\n    return (((_a$submittedAt = a.submittedAt) === null || _a$submittedAt === void 0 ? void 0 : _a$submittedAt.seconds) || 0) - (((_b$submittedAt = b.submittedAt) === null || _b$submittedAt === void 0 ? void 0 : _b$submittedAt.seconds) || 0);\n  });\n  const playersInGame = Object.values(allPlayers || {}).sort((a, b) => a.name.localeCompare(b.name));\n  const votersCount = playersInGame.filter(p => p.hasVoted).length;\n\n  // These must be defined before any useEffect or code that uses them\n  const playersWhoShouldSubmit = playersInGame;\n  const submittedCount = currentPrompt.type === 'scenario_vote' ? Object.keys(gameData.playerChoices || {}).length : submittedAnswers.length;\n  const allPlayersSubmitted = submittedCount === playersWhoShouldSubmit.length;\n  const shuffledPlayersToVoteOn = useMemo(() => {\n    if (!playersInGame) return [];\n    // Shuffle a copy of the array to avoid mutation and keep it stable\n    return shuffleArray([...playersInGame.filter(p => p.id !== userId)]);\n  }, [playersInGame, userId]);\n  useEffect(() => {\n    setSelectedCard(null);\n    setCustomAnswer('');\n    setNominationData({\n      nominatedPlayerId: '',\n      justification: ''\n    });\n    setSelectedVote(null);\n    setSelectedChoice(null);\n    setIsWritingCustom(false);\n    setCustomScenarioAnswer('');\n  }, [gameData.status, gameData.currentRound]);\n  useEffect(() => {\n    // Only trigger if current phase is 'submission' and all relevant players have submitted\n    if (isHost && gameData.status === 'submission' && allPlayersSubmitted && playersWhoShouldSubmit.length > 0) {\n      updateDoc(gameRef, {\n        status: 'voting'\n      }).catch(e => console.error(\"Error setting status to voting:\", e));\n    }\n  }, [allPlayersSubmitted, playersWhoShouldSubmit.length, isHost, gameData.status, gameRef]);\n  useEffect(() => {\n    // Only trigger if we are in the voting phase and all active players have voted\n    const votersCount = playersInGame.filter(p => p.hasVoted).length;\n    const allPlayersVoted = votersCount === playersInGame.length;\n    if (isHost && gameData.status === 'voting' && allPlayersVoted && playersInGame.length > 0) {\n      const updates = {};\n      let roundResults = {}; // For scenario_vote display\n      if (currentPrompt.type === 'scenario_vote') {\n        playersInGame.forEach(player => {\n          const choiceKey = gameData.playerChoices[player.id];\n          if (typeof choiceKey === 'undefined') return; // Skip players who didn't submit\n          const votesOnPlayer = gameData.votes[player.id] || {};\n          const hearts = (votesOnPlayer.hearts || []).length;\n          const redFlags = (votesOnPlayer.redFlags || []).length;\n          const roundScore = hearts - redFlags;\n          updates[`players.${player.id}.score`] = increment(roundScore);\n          updates[`players.${player.id}.totalHearts`] = increment(hearts);\n          updates[`players.${player.id}.totalRedFlags`] = increment(redFlags);\n          roundResults[player.id] = {\n            choiceKey,\n            hearts,\n            redFlags\n          };\n        });\n      } else {\n        // Existing scoring logic for other modes\n        let maxVotes = 0;\n        let winningSubmissions = [];\n        submittedAnswers.forEach(sub => {\n          if (sub.votes > maxVotes) {\n            maxVotes = sub.votes;\n            winningSubmissions = [sub];\n          } else if (sub.votes === maxVotes) {\n            winningSubmissions.push(sub);\n          }\n        });\n        if (maxVotes > 0) {\n          winningSubmissions.forEach(sub => {\n            updates[`players.${sub.playerId}.score`] = increment(1);\n          });\n        }\n        // Store winning submission IDs for retrieval in LeaderboardPage\n        updates.currentWinningSubmission = maxVotes > 0 ? winningSubmissions.map(s => s.id) : null;\n      }\n      updates.status = 'round_end';\n      if (currentPrompt.type === 'scenario_vote') {\n        updates.roundResults = roundResults;\n      }\n      updateDoc(gameRef, updates).catch(e => console.error(\"Error ending round:\", e));\n    }\n  }, [isHost, gameData.status, playersInGame, currentPrompt, gameData.playerChoices, gameData.votes, submittedAnswers]);\n\n  // Guard: if currentPlayer is undefined, show loading or null\n  if (!currentPlayer) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-xl text-gray-200\",\n      children: \"Joining game... Please wait.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 979,\n      columnNumber: 16\n    }, this);\n  }\n  const handleSelectCard = card => {\n    setSelectedCard(card);\n  };\n  const handleCustomAnswerChange = e => {\n    setCustomAnswer(e.target.value);\n  };\n  const handleNominationChange = (field, value) => {\n    setNominationData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n  const handleSubmitAnswer = async () => {\n    if (currentPlayer.hasSubmitted) {\n      showMessage(\"You have already submitted an answer for this round.\");\n      return;\n    }\n\n    // If it's an image judgment prompt and the image hasn't loaded yet, prevent submission\n    if (currentPrompt.type === 'image_judgment' && !currentPrompt.imageUrl && isLoadingImage) {\n      showMessage(\"Please wait for the image to finish generating before submitting.\");\n      return;\n    }\n    let answerContent = '';\n    // For fill and image_judgment, answer is a card or custom text\n    if (currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') {\n      if (selectedCard === null) {\n        showMessage(\"Please select a card or type a custom answer.\");\n        return;\n      }\n      if (selectedCard === \"BLANK_CARD_SELECTED\") {\n        if (!customAnswer.trim()) {\n          showMessage(\"Please type your custom answer.\");\n          return;\n        }\n        answerContent = customAnswer.trim();\n      } else {\n        answerContent = selectedCard;\n      }\n    } else if (currentPrompt.type === 'thisSoundsLike') {\n      if (!nominationData.nominatedPlayerId || !nominationData.justification.trim()) {\n        showMessage(\"Please select a player and provide a justification.\");\n        return;\n      }\n      answerContent = {\n        nominatedPlayerId: nominationData.nominatedPlayerId,\n        justification: nominationData.justification.trim()\n      };\n    } else {\n      showMessage(\"Invalid prompt type.\");\n      return;\n    }\n    try {\n      const submissionId = generateId();\n      const updates = {\n        [`players.${userId}.hasSubmitted`]: true,\n        // Only remove the card if it was selected from the hand and not a custom answer\n        [`players.${userId}.hand`]: (currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') && selectedCard !== \"BLANK_CARD_SELECTED\" ? currentPlayer.hand.filter(card => card !== selectedCard) : currentPlayer.hand,\n        [`submittedAnswers.${submissionId}`]: {\n          id: submissionId,\n          playerId: userId,\n          answer: answerContent,\n          votes: 0,\n          voters: [],\n          submittedAt: serverTimestamp() // Add timestamp for stable sorting\n        }\n      };\n      await updateDoc(gameRef, updates);\n      // --- Analytics: increment roundsPlayed, answersSubmitted, customAnswersSubmitted ---\n      const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, userId);\n      await updateDoc(playerStatsRef, {\n        roundsPlayed: increment(1),\n        answersSubmitted: increment(1),\n        ...(selectedCard === \"BLANK_CARD_SELECTED\" ? {\n          customAnswersSubmitted: increment(1)\n        } : {})\n      }).catch(async err => {\n        if (err.code === 'not-found') {\n          await setDoc(playerStatsRef, {\n            roundsPlayed: 1,\n            answersSubmitted: 1,\n            customAnswersSubmitted: selectedCard === \"BLANK_CARD_SELECTED\" ? 1 : 0,\n            wins: 0,\n            gamesPlayed: 0,\n            votesReceived: 0,\n            heartsReceived: 0,\n            redFlagsReceived: 0,\n            name: currentPlayer.name\n          });\n        }\n      });\n      // --- End analytics ---\n      showMessage(\"Answer submitted!\");\n    } catch (error) {\n      console.error(\"Error submitting answer:\", error);\n      showMessage(\"Failed to submit answer. Please try again.\");\n    }\n  };\n  const handleSubmitChoice = async () => {\n    const answer = isWritingCustom ? customScenarioAnswer.trim() : selectedChoice;\n    if (!answer) {\n      showMessage(\"Please select a choice or write your own answer.\");\n      return;\n    }\n    try {\n      const updates = {\n        [`players.${userId}.hasSubmitted`]: true,\n        [`playerChoices.${userId}`]: answer\n      };\n      await updateDoc(gameRef, updates);\n      showMessage(\"Your choice has been submitted!\");\n    } catch (error) {\n      console.error(\"Error submitting choice:\", error);\n      showMessage(\"Failed to submit choice. Please try again.\");\n    }\n  };\n  const handleScenarioVote = async (targetPlayerId, voteType) => {\n    if (currentPlayer.hasVoted) {\n      showMessage(\"You have already submitted your votes for this round.\");\n      return;\n    }\n\n    // Prevent voting for self for scenario_vote as well\n    if (targetPlayerId === userId) {\n      showMessage(\"You cannot vote for your own take.\");\n      return;\n    }\n    const votePath = `votes.${targetPlayerId}.${voteType}`;\n    try {\n      await updateDoc(gameRef, {\n        [votePath]: arrayUnion(userId)\n      });\n      // --- Analytics: increment heartsReceived or redFlagsReceived for the answer's owner ---\n      const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, targetPlayerId);\n      if (voteType === 'hearts') {\n        await updateDoc(playerStatsRef, {\n          heartsReceived: increment(1)\n        }).catch(async err => {\n          if (err.code === 'not-found') {\n            var _gameData$players$tar;\n            await setDoc(playerStatsRef, {\n              heartsReceived: 1,\n              name: ((_gameData$players$tar = gameData.players[targetPlayerId]) === null || _gameData$players$tar === void 0 ? void 0 : _gameData$players$tar.name) || ''\n            });\n          }\n        });\n      } else if (voteType === 'redFlags') {\n        await updateDoc(playerStatsRef, {\n          redFlagsReceived: increment(1)\n        }).catch(async err => {\n          if (err.code === 'not-found') {\n            var _gameData$players$tar2;\n            await setDoc(playerStatsRef, {\n              redFlagsReceived: 1,\n              name: ((_gameData$players$tar2 = gameData.players[targetPlayerId]) === null || _gameData$players$tar2 === void 0 ? void 0 : _gameData$players$tar2.name) || ''\n            });\n          }\n        });\n      }\n      // --- End analytics ---\n      showMessage(`${voteType === 'hearts' ? 'Heart' : 'Red Flag'} given!`);\n    } catch (error) {\n      console.error(\"Error casting scenario vote:\", error);\n      showMessage(\"Failed to cast vote.\");\n    }\n  };\n  const handleLockInVotes = async () => {\n    if (currentPlayer.hasVoted) return;\n    try {\n      await updateDoc(gameRef, {\n        [`players.${userId}.hasVoted`]: true\n      });\n      showMessage(\"Votes locked in!\");\n    } catch (error) {\n      console.error(\"Error locking in votes:\", error);\n      showMessage(\"Failed to lock in votes.\");\n    }\n  };\n  const handleVote = async submissionId => {\n    if (currentPlayer.hasVoted) {\n      showMessage(\"You've already voted this round.\");\n      return;\n    }\n    if (selectedVote) {\n      showMessage(\"You can only vote for one answer.\");\n      return;\n    }\n    const submission = submittedAnswersObj[submissionId]; // Use submittedAnswersObj directly\n    if (!submission) return;\n\n    // Prevent voting for oneself in applicable modes\n    if (submission.playerId === userId) {\n      showMessage(\"You cannot vote for your own answer.\");\n      return;\n    }\n    setSelectedVote(submissionId); // Optimistically update UI\n\n    try {\n      await updateDoc(gameRef, {\n        [`submittedAnswers.${submissionId}.votes`]: increment(1),\n        [`submittedAnswers.${submissionId}.voters`]: arrayUnion(userId),\n        [`players.${userId}.hasVoted`]: true,\n        [`votes.${submissionId}`]: arrayUnion(userId) // General vote tracking\n      });\n      // --- Analytics: increment votesReceived for the answer's owner ---\n      const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, submission.playerId);\n      await updateDoc(playerStatsRef, {\n        votesReceived: increment(1)\n      }).catch(async err => {\n        if (err.code === 'not-found') {\n          var _gameData$players$sub;\n          await setDoc(playerStatsRef, {\n            votesReceived: 1,\n            name: ((_gameData$players$sub = gameData.players[submission.playerId]) === null || _gameData$players$sub === void 0 ? void 0 : _gameData$players$sub.name) || ''\n          });\n        }\n      });\n      // --- End analytics ---\n      showMessage(\"Vote submitted!\");\n    } catch (error) {\n      console.error(\"Error submitting vote:\", error);\n      setSelectedVote(null); // Revert on error\n      showMessage(\"Failed to submit vote. Please try again.\");\n    }\n  };\n  const playerHand = (currentPlayer === null || currentPlayer === void 0 ? void 0 : currentPlayer.hand) || [];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full max-w-4xl mx-auto p-4 flex flex-col items-center justify-center\",\n    children: [/*#__PURE__*/_jsxDEV(GamePrompt, {\n      prompt: currentPrompt,\n      gameData: gameData,\n      isLoadingImage: isLoadingImage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1203,\n      columnNumber: 13\n    }, this), \" \", gameData.status === 'submission' && (currentPrompt.type === 'scenario_vote' ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full text-center\",\n      children: [!currentPlayer.hasSubmitted ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-2xl font-bold text-white mb-4\",\n          children: \"What's your take?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1210,\n          columnNumber: 33\n        }, this), isWritingCustom ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: customScenarioAnswer,\n            onChange: e => setCustomScenarioAnswer(e.target.value),\n            className: \"w-full p-3 rounded-lg bg-white text-gray-900 h-24\",\n            placeholder: \"Make it spicy...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1213,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setIsWritingCustom(false),\n            className: \"text-cyan-300 hover:text-cyan-400 mt-2\",\n            children: \"Back to choices\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1219,\n            columnNumber: 41\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1212,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-3 mb-6\",\n            children: Object.entries(currentPrompt.choices).sort((a, b) => a[0].localeCompare(b[0])).map(([key, value]) => /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setSelectedChoice(key),\n              className: `w-full text-left p-4 rounded-xl shadow-md transition transform ${selectedChoice === key ? 'bg-blue-400 scale-105 ring-4 ring-blue-500 text-white' : 'bg-white hover:bg-gray-100 text-gray-900'}`,\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"font-bold uppercase mr-3\",\n                children: [key, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1232,\n                columnNumber: 53\n              }, this), value]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1225,\n              columnNumber: 49\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1223,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setIsWritingCustom(true);\n              setSelectedChoice(null);\n            },\n            className: \"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full shadow-lg mb-4\",\n            children: \"...or write your own answer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1236,\n            columnNumber: 41\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSubmitChoice,\n          disabled: isWritingCustom ? !customScenarioAnswer.trim() : !selectedChoice,\n          className: \"w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50\",\n          children: \"Submit Choice\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1242,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-2xl text-gray-200 animate-pulse\",\n        children: \"Waiting for other players to submit their take...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1251,\n        columnNumber: 29\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-300 mt-4 text-lg\",\n        children: [\"Submitted: \", submittedCount, \" / \", playersWhoShouldSubmit.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1253,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1207,\n      columnNumber: 21\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full max-w-lg mx-auto\",\n      children: [!currentPlayer.hasSubmitted ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [currentPrompt.type !== 'thisSoundsLike' && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-bold text-white mb-4\",\n            children: \"Your Hand:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1263,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-6\",\n            children: [playerHand.map((card, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleSelectCard(card),\n              className: `p-3 rounded-lg shadow-md h-32 text-sm text-gray-900 transition-transform transform hover:scale-105 ${selectedCard === card ? 'bg-cyan-300 ring-4 ring-cyan-500' : 'bg-white hover:bg-gray-100'}`,\n              children: card\n            }, card + index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1266,\n              columnNumber: 49\n            }, this)), (currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleSelectCard(\"BLANK_CARD_SELECTED\"),\n              className: `p-3 rounded-lg shadow-md h-32 text-sm transition-transform transform hover:scale-105 ${selectedCard === \"BLANK_CARD_SELECTED\" ? 'bg-yellow-300 ring-4 ring-yellow-500 text-gray-900' : 'bg-gray-200 hover:bg-gray-300 text-gray-900'}`,\n              children: \"Write your own...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1275,\n              columnNumber: 49\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1264,\n            columnNumber: 41\n          }, this)]\n        }, void 0, true), currentPrompt.type === 'thisSoundsLike' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-bold text-white mb-2\",\n            children: \"1. Nominate a Player\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1287,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: nominationData.nominatedPlayerId,\n            onChange: e => setNominationData(prev => ({\n              ...prev,\n              nominatedPlayerId: e.target.value\n            })),\n            className: \"w-full p-3 rounded-lg bg-white text-gray-900\",\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              children: \"Select a player...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1293,\n              columnNumber: 45\n            }, this), playersInGame.filter(p => p.id !== userId).map(p => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: p.id,\n              children: p.name\n            }, p.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1295,\n              columnNumber: 49\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1288,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-bold text-white mb-2 mt-4\",\n            children: \"2. Justify your nomination\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1298,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: nominationData.justification,\n            onChange: e => setNominationData(prev => ({\n              ...prev,\n              justification: e.target.value\n            })),\n            placeholder: \"Why does this sound like them?\",\n            className: \"w-full p-3 rounded-lg bg-white text-gray-900 h-24\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1299,\n            columnNumber: 41\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1286,\n          columnNumber: 37\n        }, this), selectedCard === \"BLANK_CARD_SELECTED\" && currentPrompt.type !== 'thisSoundsLike' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-bold text-white mb-2\",\n            children: \"Write Your Custom Answer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1309,\n            columnNumber: 41\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: customAnswer,\n            onChange: e => setCustomAnswer(e.target.value),\n            className: \"w-full p-3 rounded-lg bg-white text-gray-900 h-24\",\n            placeholder: \"Make it good!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1310,\n            columnNumber: 41\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1308,\n          columnNumber: 37\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSubmitAnswer,\n          className: \"w-full bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed\",\n          disabled: (currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') && (!selectedCard || selectedCard === \"BLANK_CARD_SELECTED\" && !customAnswer.trim()) || currentPrompt.type === 'thisSoundsLike' && (!nominationData.nominatedPlayerId || !nominationData.justification.trim()),\n          children: \"Submit Answer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1318,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-2xl text-gray-200 animate-pulse\",\n        children: \"Waiting for other players to submit...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1327,\n        columnNumber: 29\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-300 mt-4 text-lg\",\n        children: [\"Submitted: \", submittedCount, \" / \", playersWhoShouldSubmit.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1329,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1258,\n      columnNumber: 21\n    }, this)), gameData.status === 'voting' && (currentPrompt.type === 'scenario_vote' ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-2xl font-bold text-white mb-4\",\n        children: \"Judge Their Takes!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1339,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-300 mb-6\",\n        children: \"Give a \\u2764\\uFE0F for a relationship goal or a \\uD83D\\uDEA9 for a red flag.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1340,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-4 mb-6\",\n        children: shuffledPlayersToVoteOn.map(player => {\n          var _gameData$votes, _gameData$votes$playe, _gameData$votes2, _gameData$votes2$play;\n          // Use shuffled players\n          const choiceValue = gameData.playerChoices[player.id];\n          const choiceText = choiceValue ? currentPrompt.choices[choiceValue] || choiceValue : \"No choice submitted.\";\n          const hearts = ((_gameData$votes = gameData.votes) === null || _gameData$votes === void 0 ? void 0 : (_gameData$votes$playe = _gameData$votes[player.id]) === null || _gameData$votes$playe === void 0 ? void 0 : _gameData$votes$playe.hearts) || [];\n          const redFlags = ((_gameData$votes2 = gameData.votes) === null || _gameData$votes2 === void 0 ? void 0 : (_gameData$votes2$play = _gameData$votes2[player.id]) === null || _gameData$votes2$play === void 0 ? void 0 : _gameData$votes2$play.redFlags) || [];\n          const hasVotedHeart = hearts.includes(userId);\n          const hasVotedFlag = redFlags.includes(userId);\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white bg-opacity-20 rounded-xl p-4 text-left\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-gray-200 mb-3 text-xl italic\",\n              children: [\"\\\"\", choiceText, \"\\\"\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1352,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-end items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleScenarioVote(player.id, 'hearts'),\n                disabled: hasVotedHeart || hasVotedFlag || currentPlayer.hasVoted,\n                className: `px-4 py-2 rounded-full font-bold text-2xl transition transform hover:scale-110 disabled:opacity-50 ${hasVotedHeart ? 'bg-pink-400' : 'bg-gray-300 hover:bg-pink-300'}`,\n                children: \"\\u2764\\uFE0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1354,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleScenarioVote(player.id, 'redFlags'),\n                disabled: hasVotedHeart || hasVotedFlag || currentPlayer.hasVoted,\n                className: `px-4 py-2 rounded-full font-bold text-2xl transition transform hover:scale-110 disabled:opacity-50 ${hasVotedFlag ? 'bg-red-500' : 'bg-gray-300 hover:bg-red-400'}`,\n                children: \"\\uD83D\\uDEA9\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1361,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1353,\n              columnNumber: 41\n            }, this)]\n          }, player.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1351,\n            columnNumber: 37\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1341,\n        columnNumber: 25\n      }, this), !currentPlayer.hasVoted && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLockInVotes,\n        className: \"w-full bg-gradient-to-r from-green-500 to-lime-400 text-white font-bold py-4 px-8 rounded-full shadow-lg\",\n        children: \"Lock In Your Votes\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1374,\n        columnNumber: 29\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-300 mt-4 text-lg\",\n        children: [\"Voted: \", votersCount, \" / \", playersInGame.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1378,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1338,\n      columnNumber: 21\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-2xl font-bold text-white mb-4\",\n        children: \"Vote for your favorite!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1384,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\",\n        children: submittedAnswers.map(sub => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative bg-white bg-opacity-20 rounded-xl p-4 flex flex-col justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-white text-lg font-semibold mb-4\",\n            children: [\"\\\"\", typeof sub.answer === 'object' && sub.answer !== null ? sub.answer.justification : sub.answer, \"\\\"\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1388,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-right\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleVote(sub.id),\n              disabled: currentPlayer.hasVoted || sub.playerId === userId,\n              className: `bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-300 disabled:opacity-50 ${sub.playerId === userId ? 'cursor-not-allowed bg-gray-400 hover:from-gray-400 hover:to-gray-400' : ''}`,\n              title: sub.playerId === userId ? \"You can't vote for your own answer\" : \"Vote for this answer\",\n              children: sub.playerId === userId ? \"Your Answer\" : \"Vote\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1392,\n              columnNumber: 41\n            }, this), gameData.votes[sub.id] && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"ml-4 text-lg font-bold text-white\",\n              children: (gameData.votes[sub.id] || []).length\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1400,\n              columnNumber: 68\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1391,\n            columnNumber: 37\n          }, this)]\n        }, sub.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1387,\n          columnNumber: 33\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1385,\n        columnNumber: 25\n      }, this), !currentPlayer.hasVoted && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-lg text-gray-300\",\n        children: \"Choose the funniest or most fitting answer!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1406,\n        columnNumber: 29\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-300 mt-4 text-lg\",\n        children: [\"Voted: \", votersCount, \" / \", playersInGame.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1408,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1383,\n      columnNumber: 21\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1202,\n    columnNumber: 9\n  }, this);\n};\n\n// LeaderboardPage Component\n_s5(GameRound, \"wUkk26FQoYxop69IjK8vjqv2eRM=\");\n_c7 = GameRound;\nconst LeaderboardPage = ({\n  gameData,\n  userId,\n  gameId,\n  showMessage,\n  handleNextRound\n}) => {\n  const isHost = gameData.hostId === userId;\n  const players = Object.values(gameData.players).sort((a, b) => b.score - a.score);\n  const currentPrompt = gameData.prompts[gameData.currentRound - 1]; // Access the correct prompt\n\n  const votersCount = players.filter(p => p.hasVoted).length;\n  const winningSubmissions = (gameData.currentWinningSubmission || []).map(id => gameData.submittedAnswers[id]).filter(Boolean);\n  const winnerNames = winningSubmissions.map(sub => {\n    var _gameData$players$sub2;\n    return (_gameData$players$sub2 = gameData.players[sub.playerId]) === null || _gameData$players$sub2 === void 0 ? void 0 : _gameData$players$sub2.name;\n  }).join(', ');\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-center p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text-4xl font-bold text-white mb-6 animate-fade-in-down\",\n      children: [\"Round \", gameData.currentRound, \" Results\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1431,\n      columnNumber: 13\n    }, this), currentPrompt && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-8 bg-white bg-opacity-20 rounded-xl p-4 max-w-2xl mx-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-lg md:text-2xl font-bold text-yellow-200 mb-2\",\n        children: \"Question:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1435,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl md:text-2xl text-white\",\n        children: currentPrompt.text\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1436,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1434,\n      columnNumber: 17\n    }, this), currentPrompt.type === 'scenario_vote' && gameData.roundResults ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 mb-8 w-full max-w-2xl mx-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-2xl font-bold text-cyan-300 mb-4\",\n        children: \"How did everyone do?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1442,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-4\",\n        children: players.map(player => {\n          const result = gameData.roundResults[player.id];\n          if (!result) return null;\n          const choiceValue = result.choiceKey;\n          const choiceText = currentPrompt.choices[choiceValue] || choiceValue;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-left p-4 bg-gray-900 bg-opacity-50 rounded-lg\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"font-bold text-white text-xl\",\n              children: [player.name, \"'s take:\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1451,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-gray-300 italic my-2\",\n              children: [\"\\\"\", choiceText, \"\\\"\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1452,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-end items-center space-x-4 text-xl\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-pink-400 font-bold\",\n                children: [\"\\u2764\\uFE0F \", result.hearts]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1454,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-red-500 font-bold\",\n                children: [\"\\uD83D\\uDEA9 \", result.redFlags]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1455,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1453,\n              columnNumber: 37\n            }, this)]\n          }, player.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1450,\n            columnNumber: 33\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1443,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1441,\n      columnNumber: 18\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 mb-8 w-full max-w-2xl mx-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-2xl font-bold text-cyan-300 mb-2\",\n        children: [\"Winning Answer\", winningSubmissions.length > 1 ? 's' : '']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1464,\n        columnNumber: 21\n      }, this), winningSubmissions.length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [winningSubmissions.map(sub => /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-white text-xl font-semibold bg-gray-900 bg-opacity-50 rounded-md p-4 my-2\",\n          children: [\"\\\"\", typeof sub.answer === 'object' && sub.answer !== null ? sub.answer.justification : sub.answer, \"\\\"\"]\n        }, sub.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1468,\n          columnNumber: 33\n        }, this)), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-300 mt-2 text-lg\",\n          children: [\"Submitted by: \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-bold text-white\",\n            children: winnerNames\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1472,\n            columnNumber: 85\n          }, this), \" (+1 point)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1472,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-white text-xl font-semibold\",\n        children: \"No winning answer this round. Everyone gets to keep their dignity.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1475,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1463,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 w-full max-w-md mx-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-3xl font-bold text-white mb-4\",\n        children: \"Leaderboard\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1482,\n        columnNumber: 17\n      }, this), gameData.category === \"Red Flag or Relationship Goal\" ? /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"space-y-3 mb-8\",\n        children: players.map((player, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n          className: `flex items-center justify-between p-4 rounded-xl shadow-md text-white ${index === 0 ? 'bg-yellow-400 bg-opacity-50' : 'bg-white bg-opacity-30'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-lg font-semibold\",\n            children: player.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1489,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-4 text-lg\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-pink-400 font-bold\",\n              children: [\"\\u2764\\uFE0F \", player.totalHearts || 0]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1491,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-red-500 font-bold\",\n              children: [\"\\uD83D\\uDEA9 \", player.totalRedFlags || 0]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1492,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1490,\n            columnNumber: 33\n          }, this)]\n        }, player.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1486,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1484,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"space-y-3 mb-8\",\n        children: players.map((player, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n          className: `flex items-center justify-between p-4 rounded-xl shadow-md ${index === 0 ? 'bg-yellow-300 text-gray-900 font-bold text-xl' : 'bg-white bg-opacity-30 text-white'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-lg font-bold\",\n              children: [index + 1, \".\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1504,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-lg\",\n              children: player.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1505,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1503,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-lg font-bold\",\n            children: [player.score, \" pts\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1507,\n            columnNumber: 33\n          }, this)]\n        }, player.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1500,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1498,\n        columnNumber: 21\n      }, this), isHost && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleNextRound,\n        className: \"w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\",\n        children: gameData.currentRound < gameData.maxRounds ? 'Next Round' : 'Show Final Results'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1513,\n        columnNumber: 21\n      }, this), !isHost && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl text-gray-300 italic\",\n        children: \"Waiting for host to continue...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1521,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1481,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1430,\n    columnNumber: 9\n  }, this);\n};\n\n// WinnerPage Component\n_c8 = LeaderboardPage;\nconst WinnerPage = ({\n  gameData,\n  userId,\n  onPlayAgain,\n  showMessage\n}) => {\n  _s6();\n  // Add ad logic here\n  const [showAd, setShowAd] = useState(true);\n  const adIndex = 0; // Always show the first ad, or randomize if you want\n  const [analyticsUpdated, setAnalyticsUpdated] = useState(false);\n  const handleCloseAd = async () => {\n    setShowAd(false);\n    // Analytics: Only the host should update analytics\n    if (gameData.hostId === userId && !analyticsUpdated) {\n      try {\n        // Increment global games played\n        const statsRef = doc(db, `artifacts/${appId}/public/data/analytics`, 'globalStats');\n        await updateDoc(statsRef, {\n          gamesPlayed: increment(1)\n        }).catch(async err => {\n          if (err.code === 'not-found') {\n            await setDoc(statsRef, {\n              gamesPlayed: 1\n            });\n          }\n        });\n        // Increment gamesPlayed and set lastPlayed for all players\n        for (const player of Object.values(gameData.players)) {\n          const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, player.id);\n          await updateDoc(playerStatsRef, {\n            gamesPlayed: increment(1),\n            lastPlayed: serverTimestamp()\n          }).catch(async err => {\n            if (err.code === 'not-found') {\n              await setDoc(playerStatsRef, {\n                gamesPlayed: 1,\n                lastPlayed: serverTimestamp(),\n                name: player.name\n              });\n            }\n          });\n        }\n        // Increment wins for the winner(s)\n        let winners = [];\n        if (gameData.category === \"Red Flag or Relationship Goal\") {\n          const players = Object.values(gameData.players);\n          let minRatio = Math.min(...players.map(p => (p.totalRedFlags || 0) / ((p.totalHearts || 0) + (p.totalRedFlags || 0) || 1)));\n          winners = players.filter(p => (p.totalRedFlags || 0) / ((p.totalHearts || 0) + (p.totalRedFlags || 0) || 1) === minRatio);\n        } else {\n          const players = Object.values(gameData.players);\n          let maxScore = Math.max(...players.map(p => p.score || 0));\n          winners = players.filter(p => (p.score || 0) === maxScore);\n        }\n        for (const winner of winners) {\n          const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, winner.id);\n          await updateDoc(playerStatsRef, {\n            wins: increment(1)\n          }).catch(async err => {\n            if (err.code === 'not-found') {\n              await setDoc(playerStatsRef, {\n                wins: 1,\n                name: winner.name\n              });\n            }\n          });\n        }\n        setAnalyticsUpdated(true);\n      } catch (err) {\n        console.error('Error updating analytics:', err);\n      }\n    }\n  };\n\n  // Add a guard clause for gameData\n  if (!gameData || !gameData.players) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center p-4 text-white\",\n      children: \"Loading final results...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1584,\n      columnNumber: 16\n    }, this);\n  }\n  const players = Object.values(gameData.players).sort((a, b) => {\n    if (gameData.category === \"Red Flag or Relationship Goal\") {\n      const aRatio = (a.totalRedFlags || 0) / ((a.totalHearts || 0) + (a.totalRedFlags || 0) || 1);\n      const bRatio = (b.totalRedFlags || 0) / ((b.totalHearts || 0) + (b.totalRedFlags || 0) || 1);\n      return aRatio - bRatio; // Sort by lowest red flag ratio\n    }\n    return (b.score || 0) - (a.score || 0); // Default score sort\n  });\n  const isHost = gameData.hostId === userId;\n  const handleDeleteGame = async () => {\n    showMessage(\"Are you sure you want to delete this game? This action cannot be undone.\", async () => {\n      try {\n        if (gameData.id) {\n          await deleteDoc(doc(db, `artifacts/${appId}/public/data/games`, gameData.id));\n          onPlayAgain(); // Go back to home page after deletion\n        } else {\n          console.error(\"Game ID is undefined, cannot delete.\");\n          showMessage(\"Failed to delete game: Game ID missing.\");\n        }\n      } catch (error) {\n        console.error(\"Error deleting game:\", error);\n        showMessage(\"Failed to delete game. Please try again.\");\n      }\n    });\n  };\n  const getPlayerTitleAndDescription = player => {\n    if (gameData.category !== \"Red Flag or Relationship Goal\") {\n      return {\n        title: `Score: ${player.score}`,\n        description: \"Played a different game mode.\"\n      };\n    }\n    const {\n      totalHearts,\n      totalRedFlags\n    } = player;\n    const totalVotes = (totalHearts || 0) + (totalRedFlags || 0);\n    if (totalVotes === 0) {\n      return {\n        title: \"Mystery Card\",\n        description: \"Not enough votes to get a read. Are you an enigma or just quiet?\"\n      };\n    }\n    const redFlagPercentage = totalRedFlags / totalVotes * 100;\n    const rating = Math.round(redFlagPercentage / 10) * 10;\n    return RED_FLAG_TITLES[rating] || {\n      title: \"Calculation Error\",\n      description: \"Something went wrong here.\"\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-center p-4\",\n    children: [showAd && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full flex flex-col items-center relative\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: POPUP_ADS[adIndex].image,\n          alt: \"Kriya Botanicals\",\n          className: \"w-48 h-48 object-cover rounded-xl mb-4 shadow-lg\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1639,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-3xl font-extrabold text-green-700 mb-2\",\n          children: POPUP_ADS[adIndex].title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1640,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-lg text-gray-800 mb-6\",\n          children: POPUP_ADS[adIndex].description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1641,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCloseAd,\n          className: \"bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\",\n          children: \"Continue\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1642,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"absolute top-2 right-4 text-xs text-gray-400\",\n          children: \"Sponsored\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1648,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1638,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1637,\n      columnNumber: 17\n    }, this), !showAd && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-5xl font-bold text-yellow-300 mb-4 animate-bounce\",\n        children: \"Game Over!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1654,\n        columnNumber: 13\n      }, this), players.length > 0 ? /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-3xl text-white mb-8\",\n        children: [\"And the winner is... \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"font-bold text-cyan-400\",\n          children: [players[0].name, \"!\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1655,\n          columnNumber: 97\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1655,\n        columnNumber: 35\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 w-full max-w-2xl mx-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"text-2xl font-bold text-white mb-4\",\n          children: \"Final Standings\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1658,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"space-y-4\",\n          children: players.map((player, index) => {\n            const {\n              title,\n              description\n            } = getPlayerTitleAndDescription(player);\n            return /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"text-left p-4 bg-gray-900 bg-opacity-50 rounded-lg text-white\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between items-center mb-1\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `text-xl font-bold ${index === 0 ? 'text-yellow-400' : ''}`,\n                  children: [index + 1, \". \", player.name]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1665,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-lg font-semibold text-cyan-300 text-right\",\n                  children: title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1666,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1664,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-gray-300 italic\",\n                children: [\"\\\"\", description, \"\\\"\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1668,\n                columnNumber: 33\n              }, this)]\n            }, player.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1663,\n              columnNumber: 29\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1659,\n          columnNumber: 18\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1657,\n        columnNumber: 13\n      }, this), isHost && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onPlayAgain,\n          className: \"w-full bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 mb-4\",\n          children: \"Play Again!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1677,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDeleteGame,\n          className: \"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\",\n          children: \"Delete This Game\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1683,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true), !isHost && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-xl text-gray-300 italic\",\n        children: \"Ask the host to start a new game!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1692,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1634,\n    columnNumber: 9\n  }, this);\n};\n\n// Utility function to shuffle an array (Fisher-Yates)\n_s6(WinnerPage, \"yw8pgYLQgc4rq+HUZuVdESjeGVY=\");\n_c9 = WinnerPage;\nconst shuffleArray = array => {\n  let currentIndex = array.length,\n    randomIndex;\n  while (currentIndex !== 0) {\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex--;\n    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n  }\n  return array;\n};\n\n// Utility function to get a random prompt that hasn't been played yet\nconst getRandomPrompt = (promptList, history) => {\n  // History should contain the 'text' of previously played prompts\n  const availablePrompts = promptList.filter(p => !history.includes(p.text));\n  if (availablePrompts.length === 0) {\n    console.warn(\"All prompts for this category have been used. Reshuffling prompts for this round.\");\n    return promptList[Math.floor(Math.random() * promptList.length)]; // If all used, pick randomly from full list\n  }\n  const randomIndex = Math.floor(Math.random() * availablePrompts.length);\n  return availablePrompts[randomIndex];\n};\nexport default App;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9;\n$RefreshReg$(_c, \"MessageModal\");\n$RefreshReg$(_c2, \"App\");\n$RefreshReg$(_c3, \"HomePage\");\n$RefreshReg$(_c4, \"LobbyPage\");\n$RefreshReg$(_c5, \"GamePage\");\n$RefreshReg$(_c6, \"GamePrompt\");\n$RefreshReg$(_c7, \"GameRound\");\n$RefreshReg$(_c8, \"LeaderboardPage\");\n$RefreshReg$(_c9, \"WinnerPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","doc","getDoc","addDoc","setDoc","updateDoc","deleteDoc","onSnapshot","collection","query","where","arrayUnion","arrayRemove","serverTimestamp","getDocs","deleteField","increment","PlayerProfile","jsxDEV","_jsxDEV","Fragment","_Fragment","firebaseConfig","JSON","parse","process","env","REACT_APP_FIREBASE_CONFIG","appId","REACT_APP_ID","app","db","auth","generateId","Math","random","toString","substring","PROMPT_CARDS","type","pillar","text","ai_prompt_description","ANSWER_CARDS","MessageModal","message","onClose","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","RED_FLAG_TITLES","title","description","POPUP_ADS","image","App","_s","userId","setUserId","currentPage","setCurrentPage","previousPage","setPreviousPage","gameId","setGameId","gameData","setGameData","setMessage","isAuthReady","setIsAuthReady","isLoadingImage","setIsLoadingImage","playerName","setPlayerName","isGenerating","setIsGenerating","user","setUser","isHost","hostId","generateRedFlagQuestion","response","fetch","method","ok","Error","json","error","console","choices","a","b","c","d","SESSION_USER_ID_KEY","unsubscribe","currentUser","initialAuthToken","REACT_APP_INITIAL_AUTH_TOKEN","uid","tempUserId","sessionStorage","getItem","crypto","randomUUID","setItem","log","firebaseUser","gameDocRef","unsubscribeGame","docSnap","exists","newData","id","data","prevData","_newData$prompts","_newData$prompts2","status","prompts","currentRound","imageUrl","generateImageForPrompt","then","showMessage","promptDescription","Promise","resolve","setTimeout","placeholderUrl","encodeURIComponent","msg","handleNextRound","gameRef","nextRound","maxRounds","finalPrompts","finalMaxRounds","promptHistory","finalPrompt","category","promptCardsForCategory","length","getRandomPrompt","min","updatedPlayers","availableCards","pId","players","player","currentHand","hand","cardsNeeded","shuffledDeck","shuffleArray","newCards","slice","push","hasSubmitted","hasVoted","updatePayload","submittedAnswers","playerChoices","votes","roundResults","currentWinningSubmission","handlePlayAgain","resetPlayers","score","totalHearts","totalRedFlags","Object","keys","renderRoomCode","gameCode","renderPage","HomePage","LobbyPage","GamePage","LeaderboardPage","WinnerPage","onPlayAgain","_c2","_s2","joinCode","setJoinCode","handleCreateGame","trim","toUpperCase","initialPlayers","name","newGameRef","mode","rounds","createdAt","handleJoinGame","q","querySnapshot","empty","gameDoc","docs","playerHand","placeholder","value","onChange","e","target","maxLength","_c3","_s3","playersInLobby","values","sort","localeCompare","handleCategoryChange","newCategory","handleStartGame","playersInGame","_finalPrompts$","i","newPrompt","initialPrompt","forEach","p","warn","cardIndex","floor","splice","map","cat","disabled","_c4","currentPrompt","GameRound","_c5","GamePrompt","prompt","_s4","setImageUrl","isGeneratingImage","setIsGeneratingImage","headers","body","stringify","res","catch","promptContent","dangerouslySetInnerHTML","__html","replace","src","alt","_c6","_s5","selectedCard","setSelectedCard","customAnswer","setCustomAnswer","nominationData","setNominationData","nominatedPlayerId","justification","selectedVote","setSelectedVote","selectedChoice","setSelectedChoice","isWritingCustom","setIsWritingCustom","customScenarioAnswer","setCustomScenarioAnswer","currentPlayer","allPlayers","submittedAnswersObj","_a$submittedAt","_b$submittedAt","submittedAt","seconds","votersCount","filter","playersWhoShouldSubmit","submittedCount","allPlayersSubmitted","shuffledPlayersToVoteOn","allPlayersVoted","updates","choiceKey","votesOnPlayer","hearts","redFlags","roundScore","maxVotes","winningSubmissions","sub","playerId","s","handleSelectCard","card","handleCustomAnswerChange","handleNominationChange","field","prev","handleSubmitAnswer","answerContent","submissionId","answer","voters","playerStatsRef","roundsPlayed","answersSubmitted","customAnswersSubmitted","err","code","wins","gamesPlayed","votesReceived","heartsReceived","redFlagsReceived","handleSubmitChoice","handleScenarioVote","targetPlayerId","voteType","votePath","_gameData$players$tar","_gameData$players$tar2","handleLockInVotes","handleVote","submission","_gameData$players$sub","entries","key","index","_gameData$votes","_gameData$votes$playe","_gameData$votes2","_gameData$votes2$play","choiceValue","choiceText","hasVotedHeart","includes","hasVotedFlag","_c7","Boolean","winnerNames","_gameData$players$sub2","join","result","_c8","_s6","showAd","setShowAd","adIndex","analyticsUpdated","setAnalyticsUpdated","handleCloseAd","statsRef","lastPlayed","winners","minRatio","maxScore","max","winner","aRatio","bRatio","handleDeleteGame","getPlayerTitleAndDescription","totalVotes","redFlagPercentage","rating","round","_c9","array","currentIndex","randomIndex","promptList","history","availablePrompts","$RefreshReg$"],"sources":["C:/Users/inava/online-game/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';\r\nimport { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, arrayUnion, arrayRemove, serverTimestamp, getDocs, deleteField, increment } from 'firebase/firestore';\r\nimport PlayerProfile from './PlayerProfile';\r\n\r\n// Firebase configuration from environment variables\r\nconst firebaseConfig = JSON.parse(process.env.REACT_APP_FIREBASE_CONFIG || '{}');\r\nconst appId = process.env.REACT_APP_ID || 'default-app-id';\r\n\r\n// Initialize Firebase outside the component to avoid re-initialization\r\nconst app = initializeApp(firebaseConfig);\r\nconst db = getFirestore(app);\r\nconst auth = getAuth(app);\r\n\r\n// Helper for generating unique IDs (not cryptographically secure, but fine for game items)\r\nconst generateId = () => Math.random().toString(36).substring(2, 11);\r\n\r\n// Pre-defined game data\r\nconst PROMPT_CARDS = {\r\n    \"Red Flag or Relationship Goal?\": [], // This will now be dynamically generated\r\n    \"Love, Laugh, or Leave?\": [\r\n        { type: \"fill\", pillar: \"Boundaries\", text: \"My date set a clear boundary by stating they wouldn't discuss anything before __________________.\" },\r\n        { type: \"fill\", pillar: \"Communication\", text: \"I knew there would be communication challenges when their opening line was, 'So, do you believe in __________________?'\" },\r\n        { type: \"fill\", pillar: \"Respect\", text: \"My date showed a shocking lack of respect when they started __________________ mid-conversation.\" },\r\n        { type: \"thisSoundsLike\", pillar: \"Compromise\", text: \"This sounds like... someone who, on a first date, orders for both of you and then says, 'No compromise on the appetizers!'\" },\r\n        { type: \"fill\", pillar: \"Boundaries\", text: \"The biggest red flag on our first date was when they instantly started talking about __________________.\" },\r\n        { type: \"fill\", pillar: \"Communication\", text: \"Their idea of 'getting to know you' involved asking about my __________________.\" },\r\n        { type: \"fill\", pillar: \"Respect\", text: \"I lost all respect for them when they pulled out a __________________ at the table.\" },\r\n        { type: \"thisSoundsLike\", pillar: \"Boundaries\", text: \"This sounds like... someone who brings their ex to a first date as a 'wingman'.\" },\r\n        {\r\n            type: \"image_judgment\",\r\n            pillar: \"Boundaries\",\r\n            text: \"What's your red flag reaction to this scene?\",\r\n            ai_prompt_description: \"A photo of a person setting up a large, elaborate, and overly aggressive 'no trespassing' sign with barbed wire around a small, innocent-looking flower bed.\"\r\n        },\r\n    ],\r\n};\r\n\r\nconst ANSWER_CARDS = [\r\n    \"a pet rock named 'Gary'\", \"my extensive collection of toenail clippings\", \"the concept of personal hygiene\",\r\n    \"a five-hour interpretive dance\", \"my imaginary friend, Bartholomew\", \"the meaning of life, according to a squirrel\",\r\n    \"their ex's entire family tree\", \"a spontaneous trip to the moon\", \"a heated debate about flat earth theories\",\r\n    \"my obsession with competitive eating\", \"the ghost of my past relationship\", \"a really bad karaoke performance\",\r\n    \"a detailed PowerPoint presentation on my insecurities\", \"my unique collection of lint\", \"a crying baby simulator\",\r\n    \"the sound of a kazoo orchestra\", \"their unedited diary entries from middle school\", \"a sock puppet show\",\r\n    \"the recipe for my grandma's infamous fruitcake\", \"a detailed analysis of my dream journal\", \"their pet goldfish\",\r\n    \"a surprise visit from a mariachi band\", \"a 30-page manifesto on why cats are superior to dogs\", \"my crippling fear of ducks\",\r\n    \"a life-sized cardboard cutout of myself\", \"the exact moment I realized I was allergic to gluten\", \"my collection of antique staplers\",\r\n    \"a detailed explanation of quantum physics\", \"their personal alien abduction story\", \"a single, lonely potato\",\r\n    \"the dark secrets of my childhood treehouse\", \"my profound love for glitter\", \"a dramatic re-enactment of my last dentist visit\",\r\n    \"a squirrel dressed as a tiny chef\", \"my secret talent for burping the alphabet backwards\", \"a miniature alpaca farm\",\r\n    \"the lingering smell of old gym socks\", \"my deep philosophical thoughts on cheese\", \"a very aggressive snail\",\r\n    \"a conspiracy theory involving garden gnomes\", \"my questionable fashion choices from the 90s\", \"the universal language of farts\",\r\n    \"a spontaneous opera performance\", \"my collection of rare, vintage sporks\", \"the exact number of hairs on my head\",\r\n    \"a detailed map of my internal organs\", \"my uncanny ability to predict the weather with my knee\", \"a flock of angry pigeons\",\r\n    \"my personal brand of awkward silence\", \"a very confused mime\", \"the entire script of a terrible B-movie\",\r\n    \"a deep dive into celebrity gossip from 2003\", \"my most embarrassing childhood story, told in interpretive dance\", \"a rogue tumbleweed\",\r\n    \"my collection of forgotten dreams\", \"a perpetually confused stare\", \"the subtle art of passive aggression\",\r\n    \"a commitment to never folding laundry again\", \"the true identity of Santa Claus\", \"a never-ending loop of elevator music\",\r\n    \"my inability to tell left from right\", \"a lifetime supply of questionable advice\", \"the secret to perfect toast\",\r\n    \"a spontaneous act of kindness towards a pigeon\", \"my irrational fear of balloons\", \"a detailed budget of my impulse purchases\",\r\n    \"the surprising history of garden hoses\", \"my unwavering dedication to napping\", \"a profound appreciation for mundane objects\",\r\n    \"my personal record for most consecutive sneezes\", \"a hidden talent for imitating barnyard animals\", \"the shocking truth about socks\",\r\n    \"my unwavering belief in unicorns\", \"a detailed analysis of my coffee preferences\", \"the silent language of eyebrow raises\",\r\n    \"a deep philosophical debate about condiments\", \"my surprising expertise in competitive napping\", \"the existential dread of a Monday morning\",\r\n    \"a profound understanding of cat psychology\", \"my secret stash of emergency chocolate\", \"the art of graceful awkwardness\",\r\n    \"a detailed plan for world domination (starting with my pantry)\", \"my most cherished collection of bottle caps\", \"the subtle nuances of air guitar\",\r\n    \"a profound appreciation for bad puns\", \"my impressive ability to procrastinate creatively\", \"the surprising comfort of mismatched socks\",\r\n    \"a detailed study of dust bunnies\", \"my personal philosophy on the optimal way to butter toast\", \"the quiet rebellion of untamed hair\",\r\n    \"a deep contemplation of the universe while staring at a ceiling fan\", \"my unwavering commitment to collecting novelty erasers\", \"the dramatic flair of a well-timed eye-roll\"\r\n];\r\n\r\n// Component for displaying temporary messages/modals instead of alerts\r\nconst MessageModal = ({ message, onClose }) => {\r\n    if (!message) return null;\r\n    return (\r\n        <div className=\"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white rounded-lg p-6 shadow-xl max-w-sm w-full text-center\">\r\n                <p className=\"text-xl font-semibold mb-4 text-gray-800\">{message}</p>\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105\"\r\n                >\r\n                    OK\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst RED_FLAG_TITLES = {\r\n    0: { title: \"Soulmate Status/ Certified Lover\", description: \"Congratulations! You are pure relationship gold. Smooth sailing, good vibes, and probably a waiting list for dates.\" },\r\n    10: { title: \"Almost Perfect / Just a Vibe\", description: \"A few tiny quirks, but nothing a little communication can't handle. You're basically custom-ordered for a healthy partnership.\" },\r\n    20: { title: \"The Minor Tune-Up / Good to Go, Mostly\", description: \"You've got some minor glitches, but nothing that derails the whole operation. A little self-awareness and effort, and you're golden.\" },\r\n    30: { title: \"The 'Work In Progress' / Relationship Project\", description: \"Okay, we see some areas for improvement. You're still worth the effort, but don't forget the manual for emotional intelligence.\" },\r\n    40: { title: \"Proceed with Caution / Yellow Light\", description: \"The warning signs are starting to flash. There's potential, but someone's gonna need a hard hat and a lot of patience to build something solid here.\" },\r\n    50: { title: \"Flip a Coin/ Mixed Bag\", description: \"You're a true enigma. Half a dream, half a nightmare. This relationship is gonna keep everyone guessing. Strap in!\" },\r\n    60: { title: \"Danger Zone / Enter at Your Own Risk\", description: \"The red flags are starting to outnumber the green ones. This connection might come with more drama than a reality TV show.\" },\r\n    70: { title: \"High Maintenance, Low Reward / The Tempting Trap\", description: \"Oh, you're charismatic alright, but behind that charm, there are some serious issues lurking. It's like a beautiful car with no brakes.\" },\r\n    80: { title: \"Warning Sign Warrior / Full Steam Ahead to Chaos\", description: \"You're not just waving red flags; you've got a whole parade of them. This relationship needs a professional, or an escape plan.\" },\r\n    90: { title: \"RUN! / Evacuate Immediately\", description: \"This isn't dating; it's an extreme sport. Every interaction is a potential landmine. Get out. Now.\" },\r\n    100: { title: \"The Walking Red Flag / Relationship Kryptonite\", description: \"You are the embodiment of every cautionary tale. A master class in 'what not to do.' Stay far, far away for everyone's safety.\" }\r\n};\r\n\r\n// Rename KRIYA_ADS to POPUP_ADS\r\nconst POPUP_ADS = [\r\n    {\r\n        title: \"Kriya Botanicals - Nourish Your Roots!\",\r\n        image: \"https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-6/473014145_1022672133212383_7455427243637921771_n.jpg?_nc_cat=111&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=xDgn4zdguJIQ7kNvwGKd2EK&_nc_oc=AdlKTmywN5e6dNvjc-yH_7PTAt12RPrNgqKMqLvT7dmfz0T0vyMRNeNVJwVjvxCroYw&_nc_zt=23&_nc_ht=scontent-mia3-1.xx&_nc_gid=1g-FyU6O3VDFy1DvpHwpIQ&oh=00_AfO1xUz6MGVrsMqNnc2j7dDQbCK7_5gHvU5ea6G2gWpHUA&oe=685F16E9\", // Example placeholder\r\n        description: \"Experience the power of nature with Kriya Botanicals natural hair products. Hydrate, strengthen, and shine—naturally! Try our best-selling leave-in conditioner today.\"\r\n    },\r\n    {\r\n        title: \"Kriya Botanicals - Curls That Wow!\",\r\n        image: \"https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-6/486493494_10161139828952543_6107835121073011412_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=833d8c&_nc_ohc=Tq5GlDW58V0Q7kNvwE80yCw&_nc_oc=Adli1caSZyzmwB3bfqDa3P5OWq2NZ6vLvvpDSdiuat-BjOWQ5a75T0YB75z8GwuIO0E&_nc_zt=23&_nc_ht=scontent-mia3-1.xx&_nc_gid=4KS3SwcRA5uIpc_UOm_AIw&oh=00_AfOFchd-nFXsXQjFWqG4XUI5190aEb7tKHfCFMRQEYBgog&oe=685F49EA\",\r\n        description: \"Unleash your curls with Kriya Botanicals. Our botanical blends define, detangle, and dazzle. Because your hair deserves the best!\"\r\n    },\r\n    {\r\n        title: \"Kriya Botanicals - Pure, Plant-Powered Beauty!\",\r\n        image: \"https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=600&q=80https://scontent-mia3-3.xx.fbcdn.net/v/t39.30808-6/470148513_18467575291005150_3673084829007527660_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=127cfc&_nc_ohc=UmuJoiF97esQ7kNvwHfL6Nj&_nc_oc=AdnjIysxZXN4E67SZMhW5Rh9rhW5fo5Q775XdrvXbhmCkAf0odlt5EZ3Nz12_L-VlmI&_nc_zt=23&_nc_ht=scontent-mia3-3.xx&_nc_gid=OavS8Zp0_-Z8vECDAJM5XQ&oh=00_AfMi6EA_D2JZLiWekipC6JII-fplbOXpldIS2Fdmb-NpFQ&oe=685F272E\",\r\n        description: \"Go green with your routine! Kriya Botanicals uses only the purest plant ingredients for healthy, happy hair. Discover your new favorite today.\"\r\n    }\r\n];\r\n\r\n// Main App Component\r\nfunction App() {\r\n    const [userId, setUserId] = useState(null);\r\n    const [currentPage, setCurrentPage] = useState('home');\r\n    const [previousPage, setPreviousPage] = useState('home');\r\n    const [gameId, setGameId] = useState(null);\r\n    const [gameData, setGameData] = useState(null);\r\n    const [message, setMessage] = useState(null);\r\n    const [isAuthReady, setIsAuthReady] = useState(false);\r\n    const [isLoadingImage, setIsLoadingImage] = useState(false); // For host loading state\r\n    const [playerName, setPlayerName] = useState(''); // New state for player nickname\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n\r\n    // Define isHost at the top level so it's available in all handlers\r\n    const isHost = gameData && gameData.hostId === userId;\r\n\r\n    // Move generateRedFlagQuestion to App scope so it's available everywhere\r\n    const generateRedFlagQuestion = async () => {\r\n        try {\r\n            const response = await fetch('http://localhost:3001/api/generate-red-flag-question', {\r\n                method: 'POST'\r\n            });\r\n            if (!response.ok) throw new Error('Failed to generate question');\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('AI backend failed, using fallback question:', error);\r\n            // Fallback question and choices\r\n            return {\r\n                type: 'scenario_vote',\r\n                text: \"Your partner insists on bringing their pet iguana to every date. What's your move?\",\r\n                choices: {\r\n                    a: \"That's a dealbreaker. I'm not sharing my fries with a lizard.\",\r\n                    b: \"Honestly, that's kind of awesome. Can I get it a tiny hat?\",\r\n                    c: \"I have so many questions, but I'm here for the chaos.\",\r\n                    d: \"As long as the iguana doesn't judge my karaoke, we're good.\"\r\n                },\r\n                pillar: \"Relationship Riddles\"\r\n            };\r\n        }\r\n    };\r\n\r\n    // Auth state listener and initial sign-in logic\r\n    useEffect(() => {\r\n        const SESSION_USER_ID_KEY = 'redFlagsGameTempUserId';\r\n\r\n        const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n            const initialAuthToken = process.env.REACT_APP_INITIAL_AUTH_TOKEN;\r\n            if (initialAuthToken) {\r\n                // If an initial auth token is provided (e.g., from the Canvas environment)\r\n                // Use Firebase authentication with the provided token.\r\n                if (!currentUser) {\r\n                    try {\r\n                        await signInWithCustomToken(auth, initialAuthToken);\r\n                    } catch (error) {\r\n                        console.error(\"Firebase Auth Error with custom token:\", error);\r\n                        setMessage(`Authentication failed: ${error.message}. Please refresh.`);\r\n                    }\r\n                }\r\n                // Once authenticated, set the user and their UID from Firebase.\r\n                if (auth.currentUser) {\r\n                    setUserId(auth.currentUser.uid);\r\n                    // Set default player name if not already set, or load from storage\r\n                    if (!playerName) {\r\n                        setPlayerName(`Player ${auth.currentUser.uid.substring(0, 4)}`);\r\n                    }\r\n                }\r\n            } else {\r\n                // If no initial auth token (e.g., in a standalone browser tab for testing)\r\n                // Generate and use a temporary, session-based user ID.\r\n                let tempUserId = sessionStorage.getItem(SESSION_USER_ID_KEY);\r\n                if (!tempUserId) {\r\n                    tempUserId = `guest_${crypto.randomUUID()}`; // Generate a unique ID\r\n                    sessionStorage.setItem(SESSION_USER_ID_KEY, tempUserId);\r\n                    console.log(\"Generated new session userId:\", tempUserId);\r\n                } else {\r\n                    console.log(\"Reusing session userId:\", tempUserId);\r\n                }\r\n\r\n                setUserId(tempUserId); // Use the session ID as the userId\r\n                // Set default player name for guest\r\n                if (!playerName) {\r\n                    setPlayerName(`Player ${tempUserId.substring(0, 5)}`);\r\n                }\r\n            }\r\n            setIsAuthReady(true); // Auth listener has completed its initial check or temp ID is set\r\n        });\r\n        return () => unsubscribe();\r\n    }, [playerName]); // Added playerName to dependencies to prevent re-rendering issues\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {\r\n            setUser(firebaseUser);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Firebase game data listener\r\n    useEffect(() => {\r\n        if (!gameId || !isAuthReady || !userId) return; // Ensure auth and user are ready\r\n\r\n        const gameDocRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\r\n        const unsubscribeGame = onSnapshot(gameDocRef, async (docSnap) => {\r\n            if (docSnap.exists()) {\r\n                const newData = { id: docSnap.id, ...docSnap.data() };\r\n\r\n                // Use functional update to compare with previous state without causing re-subscription\r\n                setGameData(prevData => {\r\n                    // If a new image judgment prompt was just set by the host, generate the image\r\n                    if (\r\n                        userId === newData.hostId &&\r\n                        newData.status === 'submission' &&\r\n                        newData.prompts[newData.currentRound - 1]?.type === 'image_judgment' &&\r\n                        !newData.prompts[newData.currentRound - 1]?.imageUrl &&\r\n                        (prevData?.currentRound !== newData.currentRound || prevData?.status !== 'submission')\r\n                    ) {\r\n                        setIsLoadingImage(true);\r\n                        generateImageForPrompt(newData.prompts[newData.currentRound - 1].ai_prompt_description).then(imageUrl => {\r\n                            updateDoc(gameDocRef, {\r\n                                [`prompts.${newData.currentRound - 1}.imageUrl`]: imageUrl,\r\n                                isLoadingImage: false\r\n                            });\r\n                            setIsLoadingImage(false);\r\n                        });\r\n                    }\r\n                    return newData; // Update the state with the new data\r\n                });\r\n\r\n                // Navigate based on game status\r\n                if (newData.status === 'submission' || newData.status === 'voting') {\r\n                    setCurrentPage('game');\r\n                } else if (newData.status === 'round_end') {\r\n                    setCurrentPage('leaderboard');\r\n                } else if (newData.status === 'game_over') {\r\n                    setCurrentPage('winner');\r\n                } else if (newData.status === 'lobby') {\r\n                    setCurrentPage('lobby');\r\n                }\r\n            } else {\r\n                console.error(\"Game document does not exist!\");\r\n                setGameId(null);\r\n                setGameData(null);\r\n                setCurrentPage('home');\r\n                showMessage(\"The game you were in no longer exists.\");\r\n            }\r\n        });\r\n\r\n        return () => unsubscribeGame();\r\n    }, [gameId, isAuthReady, userId]); // Correct dependency array, removed gameData\r\n\r\n    // Utility to generate image (placeholder)\r\n    const generateImageForPrompt = async (promptDescription) => {\r\n        console.log(\"Starting image generation for:\", promptDescription);\r\n        // This is a placeholder. In a real app, you would call your AI image model here.\r\n        // For now, we return a static placeholder image URL after a short delay.\r\n        await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate network delay\r\n        const placeholderUrl = `https://via.placeholder.com/400x300.png?text=${encodeURIComponent(promptDescription.substring(0, 30))}`;\r\n        console.log(\"Generated image URL:\", placeholderUrl);\r\n        return placeholderUrl;\r\n    };\r\n\r\n    const showMessage = (msg) => {\r\n        setMessage(msg);\r\n    };\r\n\r\n    const handleNextRound = async () => {\r\n        if (!isHost) return;\r\n\r\n        try {\r\n            const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\r\n            const nextRound = gameData.currentRound + 1;\r\n\r\n            // Always transition to winner if at or past maxRounds\r\n            if (nextRound > gameData.maxRounds || gameData.currentRound >= gameData.maxRounds) {\r\n                await updateDoc(gameRef, { status: 'winner' });\r\n                return;\r\n            }\r\n\r\n            let finalPrompts = [];\r\n            let finalMaxRounds = 10;\r\n            let promptHistory = gameData.promptHistory || [];\r\n\r\n            let finalPrompt;\r\n            if (gameData.category === \"Red Flag or Relationship Goal\") {\r\n                // For this mode, prompts are pre-generated. Just get the next one.\r\n                finalPrompt = gameData.prompts[nextRound - 1];\r\n                if (!finalPrompt) {\r\n                    console.error(\"Could not find the next prompt for Red Flag mode.\");\r\n                    await updateDoc(gameRef, { status: 'winner' });\r\n                    return;\r\n                }\r\n            } else {\r\n                // For other modes, generate a new prompt dynamically\r\n                const promptCardsForCategory = PROMPT_CARDS[gameData.category] || [];\r\n                if (promptCardsForCategory.length === 0) {\r\n                    showMessage(\"No prompts available for this category.\");\r\n                    return;\r\n                }\r\n                finalPrompt = getRandomPrompt(promptCardsForCategory, promptHistory);\r\n                promptHistory = [...promptHistory, finalPrompt.text];\r\n                finalMaxRounds = Math.min(10, promptCardsForCategory.length);\r\n            }\r\n\r\n            // Reset player states for the new round\r\n            const updatedPlayers = {};\r\n            let availableCards = [...ANSWER_CARDS]; // For replenishment logic (only used for Red Flag/Looks Like)\r\n\r\n            for (const pId in gameData.players) {\r\n                const player = gameData.players[pId];\r\n                let currentHand = player.hand || [];\r\n                // Only replenish hands for Red Flag or Relationship Goal and Looks Like\r\n                if (gameData.category === \"Red Flag or Relationship Goal\" || gameData.category === \"Looks Like\") {\r\n                    const cardsNeeded = 10 - currentHand.length;\r\n                    if (cardsNeeded > 0) {\r\n                        const shuffledDeck = shuffleArray([...availableCards]);\r\n                        const newCards = shuffledDeck.slice(0, cardsNeeded);\r\n                        currentHand.push(...newCards);\r\n                    }\r\n                }\r\n                // For all other categories, do NOT replenish hand\r\n                updatedPlayers[pId] = {\r\n                    ...player,\r\n                    hand: currentHand,\r\n                    hasSubmitted: false,\r\n                    hasVoted: false\r\n                };\r\n            }\r\n\r\n            const updatePayload = {\r\n                status: 'submission',\r\n                currentRound: nextRound,\r\n                players: updatedPlayers,\r\n                submittedAnswers: {},\r\n                playerChoices: {},\r\n                votes: {},\r\n                roundResults: deleteField(),\r\n                currentWinningSubmission: null,\r\n                isLoadingImage: finalPrompt.type === 'image_judgment'\r\n            };\r\n\r\n            // Only update prompts if they are not pre-loaded\r\n            if (gameData.category !== \"Red Flag or Relationship Goal\") {\r\n                updatePayload.prompts = [...gameData.prompts, finalPrompt];\r\n                updatePayload.promptHistory = promptHistory;\r\n            }\r\n\r\n            await updateDoc(gameRef, updatePayload);\r\n        } catch (error) {\r\n            console.error(\"Error advancing round:\", error);\r\n            showMessage(`Error advancing round: ${error.message}`);\r\n        }\r\n    };\r\n\r\n    const handlePlayAgain = async () => {\r\n        if (gameData.hostId !== userId) {\r\n            showMessage(\"Only the host can start a new game.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\r\n            \r\n            // Reset player states\r\n            const resetPlayers = { ...gameData.players };\r\n            for (const pId in resetPlayers) {\r\n                resetPlayers[pId] = {\r\n                    ...resetPlayers[pId],\r\n                    score: 0,\r\n                    hand: [],\r\n                    hasSubmitted: false,\r\n                    hasVoted: false,\r\n                    totalHearts: 0,\r\n                    totalRedFlags: 0,\r\n                };\r\n            }\r\n\r\n            await updateDoc(gameRef, {\r\n                status: 'lobby',\r\n                currentRound: 0,\r\n                maxRounds: 10,\r\n                prompts: [],\r\n                promptHistory: [],\r\n                submittedAnswers: {},\r\n                playerChoices: {},\r\n                votes: {},\r\n                roundResults: deleteField(),\r\n                currentWinningSubmission: null,\r\n                isLoadingImage: false,\r\n                players: resetPlayers,\r\n                category: Object.keys(PROMPT_CARDS)[0] // Reset to default category\r\n            });\r\n            // The onSnapshot listener will automatically handle the page transition to 'lobby'\r\n        } catch (error) {\r\n            console.error(\"Error restarting game:\", error);\r\n            showMessage(\"Failed to restart the game.\");\r\n        }\r\n    };\r\n\r\n    // Room code display (top left)\r\n    const renderRoomCode = () => {\r\n        if (gameData && gameData.gameCode) {\r\n            return (\r\n                <div className=\"fixed top-2 left-2 bg-gray-800 text-white px-4 py-2 rounded shadow-lg z-50\">\r\n                    Room Code: {gameData.gameCode}\r\n                </div>\r\n            );\r\n        }\r\n        return null;\r\n    };\r\n\r\n    // Render logic based on currentPage\r\n    const renderPage = () => {\r\n        switch (currentPage) {\r\n            case 'home':\r\n                return <HomePage setCurrentPage={setCurrentPage} setGameId={setGameId} userId={userId} showMessage={showMessage} playerName={playerName} setPlayerName={setPlayerName} />;\r\n            case 'lobby':\r\n                return <LobbyPage gameData={gameData} gameId={gameId} userId={userId} showMessage={showMessage} generateRedFlagQuestion={generateRedFlagQuestion} isHost={isHost} />;\r\n            case 'game':\r\n                return <GamePage gameData={gameData} gameId={gameId} userId={userId} showMessage={showMessage} isLoadingImage={isLoadingImage} />; // Pass isLoadingImage\r\n            case 'leaderboard':\r\n                return <LeaderboardPage gameData={gameData} userId={userId} gameId={gameId} showMessage={showMessage} handleNextRound={handleNextRound} />; // Adjusted to use updated handleNextRound via prop\r\n            case 'winner':\r\n                return <WinnerPage gameData={gameData} userId={userId} onPlayAgain={handlePlayAgain} showMessage={showMessage} />; // Pass showMessage for modal\r\n            default:\r\n                return <HomePage setCurrentPage={setCurrentPage} setGameId={setGameId} userId={userId} showMessage={showMessage} playerName={playerName} setPlayerName={setPlayerName} />;\r\n        }\r\n    };\r\n\r\n    if (!isAuthReady) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-800 via-pink-600 to-red-500 text-white font-inter\">\r\n                <p className=\"text-3xl animate-pulse\">Loading game...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-purple-800 via-pink-600 to-red-500 text-white font-inter flex flex-col items-center justify-center p-4 relative\">\r\n            {renderRoomCode()}\r\n            {/* Game/category name at the top, except on Player Profile */}\r\n            {currentPage !== 'profile' && (\r\n                <h1 className=\"text-5xl md:text-6xl font-extrabold text-center mb-8 drop-shadow-lg leading-tight\">\r\n                    {gameData && gameData.category ? gameData.category : 'Red Flags & Relationship Goals'}\r\n                </h1>\r\n            )}\r\n            {renderPage()}\r\n        </div>\r\n    );\r\n}\r\n\r\n// HomePage Component\r\nconst HomePage = ({ setCurrentPage, setGameId, userId, showMessage, playerName, setPlayerName }) => {\r\n    const [joinCode, setJoinCode] = useState('');\r\n\r\n    const handleCreateGame = async () => {\r\n        if (!playerName.trim()) {\r\n            showMessage(\"Please enter your nickname.\");\r\n            return;\r\n        }\r\n        try {\r\n            const gameCode = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n            const initialPlayers = {};\r\n            initialPlayers[userId] = {\r\n                id: userId,\r\n                name: playerName.trim(),\r\n                score: 0,\r\n                isHost: true,\r\n                hand: [],\r\n                hasSubmitted: false,\r\n                hasVoted: false,\r\n                totalRedFlags: 0,\r\n                totalHearts: 0\r\n            };\r\n            const newGameRef = await addDoc(collection(db, `artifacts/${appId}/public/data/games`), {\r\n                hostId: userId,\r\n                category: \"Can We Talk?\",\r\n                mode: \"canWeTalk\",\r\n                currentRound: 0,\r\n                rounds: [],\r\n                status: 'lobby',\r\n                players: initialPlayers,\r\n                gameCode: gameCode,\r\n                createdAt: serverTimestamp()\r\n            });\r\n            setGameId(newGameRef.id);\r\n            setCurrentPage('lobby');\r\n            showMessage(`Game created! Share code: ${gameCode}`);\r\n        } catch (error) {\r\n            console.error(\"Error creating game:\", error);\r\n            showMessage(\"Failed to create game. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const handleJoinGame = async () => {\r\n        if (!playerName.trim()) {\r\n            showMessage(\"Please enter your nickname.\");\r\n            return;\r\n        }\r\n        if (!joinCode) {\r\n            showMessage(\"Please enter a game code.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            console.log(`Attempting to query Firestore for collection: artifacts/${appId}/public/data/games with gameCode: ${joinCode.toUpperCase()}`); // More detailed debugging log\r\n            const q = query(collection(db, `artifacts/${appId}/public/data/games`), where(\"gameCode\", \"==\", joinCode.toUpperCase()));\r\n            const querySnapshot = await getDocs(q);\r\n            console.log(\"Query Snapshot empty:\", querySnapshot.empty); // Debugging log\r\n\r\n            if (!querySnapshot.empty) {\r\n                const gameDoc = querySnapshot.docs[0];\r\n                const gameData = gameDoc.data();\r\n                const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameDoc.id);\r\n\r\n                // Allow joining at any status\r\n                if (gameData.players[userId]) {\r\n                    showMessage(\"You are already in this game.\");\r\n                    // Route to the correct page based on game status\r\n                    if (gameData.status === 'submission' || gameData.status === 'voting') {\r\n                        setCurrentPage('game');\r\n                    } else if (gameData.status === 'round_end') {\r\n                        setCurrentPage('leaderboard');\r\n                    } else if (gameData.status === 'game_over') {\r\n                        setCurrentPage('winner');\r\n                    } else {\r\n                        setCurrentPage('lobby');\r\n                    }\r\n                    setGameId(gameDoc.id);\r\n                    return;\r\n                }\r\n\r\n                // Give initial cards\r\n                const playerHand = shuffleArray([...ANSWER_CARDS]).slice(0, 10);\r\n\r\n                await updateDoc(gameRef, {\r\n                    [`players.${userId}`]: {\r\n                        id: userId, // Added unique ID for the player object\r\n                        name: playerName.trim(), // Use custom player name\r\n                        score: 0,\r\n                        isHost: false,\r\n                        hand: playerHand,\r\n                        hasSubmitted: false,\r\n                        hasVoted: false,\r\n                        totalRedFlags: 0,\r\n                        totalHearts: 0\r\n                    }\r\n                });\r\n                setGameId(gameDoc.id);\r\n                // Route to the correct page based on game status\r\n                if (gameData.status === 'submission' || gameData.status === 'voting') {\r\n                    setCurrentPage('game');\r\n                } else if (gameData.status === 'round_end') {\r\n                    setCurrentPage('leaderboard');\r\n                } else if (gameData.status === 'game_over') {\r\n                    setCurrentPage('winner');\r\n                } else {\r\n                    setCurrentPage('lobby');\r\n                }\r\n                showMessage(`Joined game ${joinCode}!`);\r\n            } else {\r\n                showMessage(\"Invalid game code.\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error joining game:\", error);\r\n            showMessage(\"Failed to join game. Please try again.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"text-center\">\r\n            <input\r\n                type=\"text\"\r\n                placeholder=\"Enter your nickname\"\r\n                value={playerName}\r\n                onChange={(e) => setPlayerName(e.target.value)}\r\n                className=\"w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4 text-center\"\r\n                maxLength=\"20\" // Limit nickname length\r\n            />\r\n            <button\r\n                onClick={handleCreateGame}\r\n                className=\"w-full mb-4 bg-gradient-to-r from-blue-500 to-teal-400 hover:from-blue-600 hover:to-teal-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\"\r\n            >\r\n                Create New Game\r\n            </button>\r\n            <div className=\"mb-6\">\r\n                <p className=\"text-gray-200 mb-2\">OR</p>\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Enter Game Code\"\r\n                    value={joinCode}\r\n                    onChange={(e) => setJoinCode(e.target.value)}\r\n                    className=\"w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-3 text-center uppercase\"\r\n                    maxLength=\"6\"\r\n                />\r\n                <button\r\n                    onClick={handleJoinGame}\r\n                    className=\"w-full bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\"\r\n                >\r\n                    Join Game\r\n                </button>\r\n            </div>\r\n            <p className=\"text-sm text-gray-300 mt-4\">\r\n                Minimum 2 players needed to start a game.\r\n            </p>\r\n        </div>\r\n    );\r\n};\r\n\r\n// LobbyPage Component\r\nconst LobbyPage = ({ gameData, gameId, userId, showMessage, generateRedFlagQuestion, isHost }) => {\r\n    // Move useState to the top\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n\r\n    // Add a more specific check to ensure gameData and its nested properties are loaded\r\n    if (!gameData || !gameData.hostId || !gameData.players) {\r\n        return <p className=\"text-center text-xl text-gray-200 animate-pulse\">Loading lobby...</p>;\r\n    }\r\n\r\n    const playersInLobby = Object.values(gameData.players).sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n    const handleCategoryChange = async (e) => {\r\n        if (!isHost) return;\r\n        const newCategory = e.target.value;\r\n        try {\r\n            const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\r\n            await updateDoc(gameRef, { category: newCategory });\r\n        } catch (error) {\r\n            console.error(\"Error updating category:\", error);\r\n            showMessage(\"Failed to update category.\");\r\n        }\r\n    };\r\n\r\n    const handleStartGame = async () => {\r\n        if (!isHost) return;\r\n\r\n        const playersInGame = Object.values(gameData.players);\r\n        if (playersInGame.length < 1) { // Allows solo testing\r\n            showMessage(\"You need at least 1 player to start the game.\");\r\n            return;\r\n        }\r\n\r\n        setIsGenerating(true);\r\n        try {\r\n            const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\r\n            \r\n            let finalPrompts = [];\r\n            let finalMaxRounds = 10;\r\n            let promptHistory = [];\r\n\r\n            if (gameData.category === \"Red Flag or Relationship Goal\") {\r\n                for (let i = 0; i < 10; i++) {\r\n                    const newPrompt = await generateRedFlagQuestion();\r\n                    finalPrompts.push(newPrompt);\r\n                }\r\n                finalMaxRounds = finalPrompts.length;\r\n            } else {\r\n                const promptCardsForCategory = PROMPT_CARDS[gameData.category] || [];\r\n                if (promptCardsForCategory.length === 0) {\r\n                    showMessage(\"No prompts available for this category.\");\r\n                    setIsGenerating(false);\r\n                    return;\r\n                }\r\n                const initialPrompt = getRandomPrompt(promptCardsForCategory, []);\r\n                finalPrompts.push(initialPrompt);\r\n                finalMaxRounds = Math.min(10, promptCardsForCategory.length);\r\n            }\r\n\r\n            finalPrompts.forEach(p => promptHistory.push(p.text));\r\n            \r\n            // Distribute unique hands to all players\r\n            let availableCards = [...ANSWER_CARDS];\r\n            const updatedPlayers = { ...gameData.players };\r\n\r\n            for (const pId in updatedPlayers) {\r\n                const hand = [];\r\n                // Ensure players always have 10 cards at the start of the game\r\n                for (let i = 0; i < 10; i++) {\r\n                    if (availableCards.length === 0) {\r\n                        // If pool runs low, replenish it with all ANSWER_CARDS shuffled\r\n                        availableCards = shuffleArray([...ANSWER_CARDS]);\r\n                        console.warn(\"Answer card pool replenished by reshuffling all cards during initial deal.\");\r\n                    }\r\n                    const cardIndex = Math.floor(Math.random() * availableCards.length);\r\n                    hand.push(availableCards.splice(cardIndex, 1)[0]);\r\n                }\r\n                updatedPlayers[pId].hand = hand;\r\n                updatedPlayers[pId].hasSubmitted = false;\r\n                updatedPlayers[pId].hasVoted = false;\r\n            }\r\n\r\n            await updateDoc(gameRef, {\r\n                status: 'submission',\r\n                currentRound: 1,\r\n                maxRounds: finalMaxRounds,\r\n                prompts: finalPrompts,\r\n                promptHistory: promptHistory,\r\n                players: updatedPlayers,\r\n                playerChoices: {},\r\n                submittedAnswers: {},\r\n                votes: {},\r\n                isLoadingImage: finalPrompts[0]?.type === 'image_judgment'\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error(\"Error starting game:\", error);\r\n            showMessage(\"An error occurred while starting the game.\");\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"text-center p-4\">\r\n            <h2 className=\"text-4xl font-bold mb-4 text-white\">Game Lobby</h2>\r\n            <p className=\"text-xl text-gray-200 mb-6\">\r\n                Game Code: <span className=\"font-bold text-yellow-300\">{gameData.gameCode}</span>\r\n            </p>\r\n            <div className=\"text-lg text-gray-200 mb-2 flex items-center justify-center\">\r\n                <span className=\"mr-2\">Category:</span>\r\n                {isHost ? (\r\n                    <select\r\n                        value={gameData.category}\r\n                        onChange={handleCategoryChange}\r\n                        className=\"p-2 rounded-lg bg-white bg-opacity-20 text-white font-semibold focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n                    >\r\n                        {Object.keys(PROMPT_CARDS).map(cat => (\r\n                            <option key={cat} value={cat} className=\"text-black\">{cat}</option>\r\n                        ))}\r\n                    </select>\r\n                ) : (\r\n                    <span className=\"font-semibold text-pink-200\">{gameData.category}</span>\r\n                )}\r\n            </div>\r\n            <p className=\"text-lg text-gray-200 mb-4\">Players Connected:</p>\r\n            <ul className=\"list-disc list-inside text-left mx-auto max-w-xs mb-8 text-gray-100\">\r\n                {playersInLobby.map(player => (\r\n                    <li key={player.id} className=\"py-1\">\r\n                        {player.name} {player.isHost && \"(Host)\"}\r\n                    </li>\r\n                ))}\r\n            </ul>\r\n            {isHost && (\r\n                <div className=\"mt-6\">\r\n                    {isGenerating ? (\r\n                        <div className=\"text-center\">\r\n                            <p className=\"text-2xl text-white animate-pulse\">We are generating hilarious and problematic scenarios...</p>\r\n                            <p className=\"text-gray-400 mt-2\">This might take a moment.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <button\r\n                            onClick={handleStartGame}\r\n                            disabled={!isHost || playersInLobby.length < 1}\r\n                            className=\"w-full bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                            Start Game\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            )}\r\n            {!isHost && (\r\n                <p className=\"text-xl text-gray-300 italic\">Waiting for host to start the game!</p>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// GamePage Component\r\nconst GamePage = ({ gameData, gameId, userId, showMessage, isLoadingImage }) => { // Pass isLoadingImage\r\n    if (!gameData || !gameData.prompts || gameData.prompts.length === 0) {\r\n        return <p className=\"text-center text-xl text-gray-200\">Waiting for game to start...</p>;\r\n    }\r\n    const currentPrompt = gameData.prompts[gameData.currentRound - 1];\r\n\r\n    if (!currentPrompt) {\r\n        return <p className=\"text-center text-xl text-gray-200\">Loading prompt data...</p>;\r\n    }\r\n\r\n    return <GameRound gameData={gameData} gameId={gameId} userId={userId} showMessage={showMessage} isLoadingImage={isLoadingImage} />; // Pass isLoadingImage\r\n};\r\n\r\nconst GamePrompt = ({ prompt, gameData, isLoadingImage }) => { // Receive isLoadingImage\r\n    const [imageUrl, setImageUrl] = useState(prompt.imageUrl);\r\n    const [isGeneratingImage, setIsGeneratingImage] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (\r\n            prompt.category === 'Looks Like' &&\r\n            !imageUrl &&\r\n            prompt.pillar\r\n        ) {\r\n            setIsGeneratingImage(true);\r\n            fetch('/api/generate-relationship-image', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    pillar: prompt.pillar,\r\n                    description: prompt.ai_prompt_description // send the full scenario\r\n                })\r\n            })\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setImageUrl(data.imageUrl);\r\n                setIsGeneratingImage(false);\r\n                // Optionally: update Firestore with the new imageUrl for this prompt\r\n            })\r\n            .catch(() => setIsGeneratingImage(false));\r\n        }\r\n    }, [prompt, imageUrl]);\r\n\r\n    if (!prompt) return null;\r\n\r\n    // Show loading message if it's an image prompt AND host is currently generating it\r\n    if ((prompt.type === 'image_judgment' && isLoadingImage) || isGeneratingImage) { // Check local loading state\r\n        return (\r\n            <div className=\"text-center p-4\">\r\n                <h2 className=\"text-3xl font-bold mb-4 text-white animate-pulse\">Generating AI Image...</h2>\r\n                <p className=\"text-xl text-gray-200\">The host is creating a new visual prompt. Please wait.</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Guard: if prompt.text is undefined, show a fallback or handle image-only prompts\r\n    let promptContent;\r\n    if (prompt.category === 'Looks Like') {\r\n        // For Looks Like, do NOT display any prompt text or description\r\n        promptContent = null;\r\n    } else if (typeof prompt.text === 'string') {\r\n        promptContent = <p className=\"text-3xl md:text-4xl font-extrabold text-white leading-tight\"\r\n            dangerouslySetInnerHTML={{ __html: prompt.text.replace(/__________________/g, '<span class=\\\"text-pink-300 underline\\\">BLANK</span>') }}\r\n        />;\r\n    } else if ((prompt.type === 'image_judgment' || prompt.category === 'Looks Like') && prompt.ai_prompt_description) {\r\n        promptContent = <p className=\"text-2xl font-bold text-white mb-2\">{prompt.ai_prompt_description}</p>;\r\n    } else {\r\n        promptContent = <p className=\"text-2xl font-bold text-white mb-2\">No prompt text available.</p>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"text-center bg-white bg-opacity-20 rounded-xl p-4 md:p-6 shadow-xl w-full max-w-2xl border border-white border-opacity-30 mb-6\">\r\n            <p className=\"text-xl font-bold text-yellow-200 mb-2\">{prompt.pillar}</p>\r\n            {promptContent}\r\n            {(prompt.type === 'image_judgment' || prompt.category === 'Looks Like') && imageUrl && (\r\n                <img src={imageUrl} alt={prompt.ai_prompt_description || prompt.pillar} className=\"mt-4 rounded-lg shadow-lg mx-auto w-full max-w-md h-auto object-contain\" />\r\n            )}\r\n            <p className=\"mt-4 text-lg text-gray-200\">\r\n                Round {gameData.currentRound} of {gameData.maxRounds}\r\n            </p>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst GameRound = ({ gameData, gameId, userId, showMessage, isLoadingImage }) => { // Receive isLoadingImage\r\n    // Move all hooks to the top\r\n    const [selectedCard, setSelectedCard] = useState(null);\r\n    const [customAnswer, setCustomAnswer] = useState('');\r\n    const [nominationData, setNominationData] = useState({ nominatedPlayerId: '', justification: '' });\r\n    const [selectedVote, setSelectedVote] = useState(null);\r\n    const [selectedChoice, setSelectedChoice] = useState(null); // For scenario_vote\r\n    const [isWritingCustom, setIsWritingCustom] = useState(false);\r\n    const [customScenarioAnswer, setCustomScenarioAnswer] = useState('');\r\n\r\n    const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);\r\n    const currentPlayer = gameData.players[userId];\r\n    const { players: allPlayers, currentRound, status, prompts, submittedAnswers: submittedAnswersObj } = gameData;\r\n    const currentPrompt = prompts[currentRound - 1]; // Access the correct prompt based on round\r\n    const isHost = gameData.hostId === userId;\r\n\r\n    const submittedAnswers = Object.values(submittedAnswersObj || {}).sort((a, b) => (a.submittedAt?.seconds || 0) - (b.submittedAt?.seconds || 0));\r\n    const playersInGame = Object.values(allPlayers || {}).sort((a, b) => a.name.localeCompare(b.name));\r\n    const votersCount = playersInGame.filter(p => p.hasVoted).length;\r\n\r\n    // These must be defined before any useEffect or code that uses them\r\n    const playersWhoShouldSubmit = playersInGame;\r\n    const submittedCount = currentPrompt.type === 'scenario_vote'\r\n        ? Object.keys(gameData.playerChoices || {}).length\r\n        : submittedAnswers.length;\r\n    const allPlayersSubmitted = submittedCount === playersWhoShouldSubmit.length;\r\n\r\n    const shuffledPlayersToVoteOn = useMemo(() => {\r\n        if (!playersInGame) return [];\r\n        // Shuffle a copy of the array to avoid mutation and keep it stable\r\n        return shuffleArray([...playersInGame.filter(p => p.id !== userId)]);\r\n    }, [playersInGame, userId]);\r\n\r\n    useEffect(() => {\r\n        setSelectedCard(null);\r\n        setCustomAnswer('');\r\n        setNominationData({ nominatedPlayerId: '', justification: '' });\r\n        setSelectedVote(null);\r\n        setSelectedChoice(null);\r\n        setIsWritingCustom(false);\r\n        setCustomScenarioAnswer('');\r\n    }, [gameData.status, gameData.currentRound]);\r\n\r\n    useEffect(() => {\r\n        // Only trigger if current phase is 'submission' and all relevant players have submitted\r\n        if (isHost && gameData.status === 'submission' && allPlayersSubmitted && playersWhoShouldSubmit.length > 0) {\r\n            updateDoc(gameRef, { status: 'voting' }).catch(e => console.error(\"Error setting status to voting:\", e));\r\n        }\r\n    }, [allPlayersSubmitted, playersWhoShouldSubmit.length, isHost, gameData.status, gameRef]);\r\n\r\n    useEffect(() => {\r\n        // Only trigger if we are in the voting phase and all active players have voted\r\n        const votersCount = playersInGame.filter(p => p.hasVoted).length;\r\n        const allPlayersVoted = votersCount === playersInGame.length;\r\n        if (isHost && gameData.status === 'voting' && allPlayersVoted && playersInGame.length > 0) {\r\n            const updates = {};\r\n            let roundResults = {}; // For scenario_vote display\r\n            if (currentPrompt.type === 'scenario_vote') {\r\n                playersInGame.forEach(player => {\r\n                    const choiceKey = gameData.playerChoices[player.id];\r\n                    if (typeof choiceKey === 'undefined') return; // Skip players who didn't submit\r\n                    const votesOnPlayer = gameData.votes[player.id] || {};\r\n                    const hearts = (votesOnPlayer.hearts || []).length;\r\n                    const redFlags = (votesOnPlayer.redFlags || []).length;\r\n                    const roundScore = hearts - redFlags;\r\n                    updates[`players.${player.id}.score`] = increment(roundScore);\r\n                    updates[`players.${player.id}.totalHearts`] = increment(hearts);\r\n                    updates[`players.${player.id}.totalRedFlags`] = increment(redFlags);\r\n                    roundResults[player.id] = {\r\n                        choiceKey,\r\n                        hearts,\r\n                        redFlags\r\n                    };\r\n                });\r\n            } else {\r\n                // Existing scoring logic for other modes\r\n                let maxVotes = 0;\r\n                let winningSubmissions = [];\r\n                submittedAnswers.forEach(sub => {\r\n                    if (sub.votes > maxVotes) {\r\n                        maxVotes = sub.votes;\r\n                        winningSubmissions = [sub];\r\n                    } else if (sub.votes === maxVotes) {\r\n                        winningSubmissions.push(sub);\r\n                    }\r\n                });\r\n                if (maxVotes > 0) {\r\n                    winningSubmissions.forEach(sub => {\r\n                        updates[`players.${sub.playerId}.score`] = increment(1);\r\n                    });\r\n                }\r\n                // Store winning submission IDs for retrieval in LeaderboardPage\r\n                updates.currentWinningSubmission = maxVotes > 0 ? winningSubmissions.map(s => s.id) : null;\r\n            }\r\n            updates.status = 'round_end';\r\n            if (currentPrompt.type === 'scenario_vote') {\r\n                updates.roundResults = roundResults;\r\n            }\r\n            updateDoc(gameRef, updates).catch(e => console.error(\"Error ending round:\", e));\r\n        }\r\n    }, [isHost, gameData.status, playersInGame, currentPrompt, gameData.playerChoices, gameData.votes, submittedAnswers]);\r\n\r\n    // Guard: if currentPlayer is undefined, show loading or null\r\n    if (!currentPlayer) {\r\n        return <p className=\"text-center text-xl text-gray-200\">Joining game... Please wait.</p>;\r\n    }\r\n\r\n    const handleSelectCard = (card) => {\r\n        setSelectedCard(card);\r\n    };\r\n\r\n    const handleCustomAnswerChange = (e) => {\r\n        setCustomAnswer(e.target.value);\r\n    };\r\n\r\n    const handleNominationChange = (field, value) => {\r\n        setNominationData(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleSubmitAnswer = async () => {\r\n        if (currentPlayer.hasSubmitted) {\r\n            showMessage(\"You have already submitted an answer for this round.\");\r\n            return;\r\n        }\r\n\r\n        // If it's an image judgment prompt and the image hasn't loaded yet, prevent submission\r\n        if (currentPrompt.type === 'image_judgment' && !currentPrompt.imageUrl && isLoadingImage) {\r\n            showMessage(\"Please wait for the image to finish generating before submitting.\");\r\n            return;\r\n        }\r\n\r\n        let answerContent = '';\r\n        // For fill and image_judgment, answer is a card or custom text\r\n        if (currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') {\r\n            if (selectedCard === null) {\r\n                showMessage(\"Please select a card or type a custom answer.\");\r\n                return;\r\n            }\r\n            if (selectedCard === \"BLANK_CARD_SELECTED\") {\r\n                if (!customAnswer.trim()) {\r\n                    showMessage(\"Please type your custom answer.\");\r\n                    return;\r\n                }\r\n                answerContent = customAnswer.trim();\r\n            } else {\r\n                answerContent = selectedCard;\r\n            }\r\n        } else if (currentPrompt.type === 'thisSoundsLike') {\r\n            if (!nominationData.nominatedPlayerId || !nominationData.justification.trim()) {\r\n                showMessage(\"Please select a player and provide a justification.\");\r\n                return;\r\n            }\r\n            answerContent = {\r\n                nominatedPlayerId: nominationData.nominatedPlayerId,\r\n                justification: nominationData.justification.trim()\r\n            };\r\n        } else {\r\n            showMessage(\"Invalid prompt type.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const submissionId = generateId();\r\n            const updates = {\r\n                [`players.${userId}.hasSubmitted`]: true,\r\n                // Only remove the card if it was selected from the hand and not a custom answer\r\n                [`players.${userId}.hand`]: (currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') && selectedCard !== \"BLANK_CARD_SELECTED\"\r\n                    ? currentPlayer.hand.filter(card => card !== selectedCard)\r\n                    : currentPlayer.hand,\r\n                [`submittedAnswers.${submissionId}`]: {\r\n                    id: submissionId,\r\n                    playerId: userId,\r\n                    answer: answerContent,\r\n                    votes: 0,\r\n                    voters: [],\r\n                    submittedAt: serverTimestamp() // Add timestamp for stable sorting\r\n                }\r\n            };\r\n\r\n            await updateDoc(gameRef, updates);\r\n            // --- Analytics: increment roundsPlayed, answersSubmitted, customAnswersSubmitted ---\r\n            const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, userId);\r\n            await updateDoc(playerStatsRef, {\r\n                roundsPlayed: increment(1),\r\n                answersSubmitted: increment(1),\r\n                ...(selectedCard === \"BLANK_CARD_SELECTED\" ? { customAnswersSubmitted: increment(1) } : {})\r\n            }).catch(async (err) => {\r\n                if (err.code === 'not-found') {\r\n                    await setDoc(playerStatsRef, {\r\n                        roundsPlayed: 1,\r\n                        answersSubmitted: 1,\r\n                        customAnswersSubmitted: selectedCard === \"BLANK_CARD_SELECTED\" ? 1 : 0,\r\n                        wins: 0,\r\n                        gamesPlayed: 0,\r\n                        votesReceived: 0,\r\n                        heartsReceived: 0,\r\n                        redFlagsReceived: 0,\r\n                        name: currentPlayer.name\r\n                    });\r\n                }\r\n            });\r\n            // --- End analytics ---\r\n            showMessage(\"Answer submitted!\");\r\n        } catch (error) {\r\n            console.error(\"Error submitting answer:\", error);\r\n            showMessage(\"Failed to submit answer. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const handleSubmitChoice = async () => {\r\n        const answer = isWritingCustom ? customScenarioAnswer.trim() : selectedChoice;\r\n        if (!answer) {\r\n            showMessage(\"Please select a choice or write your own answer.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const updates = {\r\n                [`players.${userId}.hasSubmitted`]: true,\r\n                [`playerChoices.${userId}`]: answer\r\n            };\r\n            await updateDoc(gameRef, updates);\r\n            showMessage(\"Your choice has been submitted!\");\r\n        } catch (error) {\r\n            console.error(\"Error submitting choice:\", error);\r\n            showMessage(\"Failed to submit choice. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const handleScenarioVote = async (targetPlayerId, voteType) => {\r\n        if (currentPlayer.hasVoted) {\r\n            showMessage(\"You have already submitted your votes for this round.\");\r\n            return;\r\n        }\r\n\r\n        // Prevent voting for self for scenario_vote as well\r\n        if (targetPlayerId === userId) {\r\n            showMessage(\"You cannot vote for your own take.\");\r\n            return;\r\n        }\r\n\r\n        const votePath = `votes.${targetPlayerId}.${voteType}`;\r\n        try {\r\n            await updateDoc(gameRef, {\r\n                [votePath]: arrayUnion(userId)\r\n            });\r\n            // --- Analytics: increment heartsReceived or redFlagsReceived for the answer's owner ---\r\n            const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, targetPlayerId);\r\n            if (voteType === 'hearts') {\r\n                await updateDoc(playerStatsRef, { heartsReceived: increment(1) }).catch(async (err) => {\r\n                    if (err.code === 'not-found') {\r\n                        await setDoc(playerStatsRef, { heartsReceived: 1, name: gameData.players[targetPlayerId]?.name || '' });\r\n                    }\r\n                });\r\n            } else if (voteType === 'redFlags') {\r\n                await updateDoc(playerStatsRef, { redFlagsReceived: increment(1) }).catch(async (err) => {\r\n                    if (err.code === 'not-found') {\r\n                        await setDoc(playerStatsRef, { redFlagsReceived: 1, name: gameData.players[targetPlayerId]?.name || '' });\r\n                    }\r\n                });\r\n            }\r\n            // --- End analytics ---\r\n            showMessage(`${voteType === 'hearts' ? 'Heart' : 'Red Flag'} given!`);\r\n        } catch (error) {\r\n            console.error(\"Error casting scenario vote:\", error);\r\n            showMessage(\"Failed to cast vote.\");\r\n        }\r\n    };\r\n\r\n    const handleLockInVotes = async () => {\r\n        if (currentPlayer.hasVoted) return;\r\n        try {\r\n            await updateDoc(gameRef, { [`players.${userId}.hasVoted`]: true });\r\n            showMessage(\"Votes locked in!\");\r\n        } catch (error) {\r\n            console.error(\"Error locking in votes:\", error);\r\n            showMessage(\"Failed to lock in votes.\");\r\n        }\r\n    };\r\n\r\n    const handleVote = async (submissionId) => {\r\n        if (currentPlayer.hasVoted) {\r\n            showMessage(\"You've already voted this round.\");\r\n            return;\r\n        }\r\n        if (selectedVote) {\r\n            showMessage(\"You can only vote for one answer.\");\r\n            return;\r\n        }\r\n\r\n        const submission = submittedAnswersObj[submissionId]; // Use submittedAnswersObj directly\r\n        if (!submission) return;\r\n\r\n        // Prevent voting for oneself in applicable modes\r\n        if (submission.playerId === userId) {\r\n            showMessage(\"You cannot vote for your own answer.\");\r\n            return;\r\n        }\r\n\r\n        setSelectedVote(submissionId); // Optimistically update UI\r\n\r\n        try {\r\n            await updateDoc(gameRef, {\r\n                [`submittedAnswers.${submissionId}.votes`]: increment(1),\r\n                [`submittedAnswers.${submissionId}.voters`]: arrayUnion(userId),\r\n                [`players.${userId}.hasVoted`]: true,\r\n                [`votes.${submissionId}`]: arrayUnion(userId) // General vote tracking\r\n            });\r\n            // --- Analytics: increment votesReceived for the answer's owner ---\r\n            const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, submission.playerId);\r\n            await updateDoc(playerStatsRef, { votesReceived: increment(1) }).catch(async (err) => {\r\n                if (err.code === 'not-found') {\r\n                    await setDoc(playerStatsRef, { votesReceived: 1, name: gameData.players[submission.playerId]?.name || '' });\r\n                }\r\n            });\r\n            // --- End analytics ---\r\n            showMessage(\"Vote submitted!\");\r\n        } catch (error) {\r\n            console.error(\"Error submitting vote:\", error);\r\n            setSelectedVote(null); // Revert on error\r\n            showMessage(\"Failed to submit vote. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const playerHand = currentPlayer?.hand || [];\r\n\r\n    return (\r\n        <div className=\"w-full max-w-4xl mx-auto p-4 flex flex-col items-center justify-center\">\r\n            <GamePrompt prompt={currentPrompt} gameData={gameData} isLoadingImage={isLoadingImage} /> {/* Pass isLoadingImage */}\r\n\r\n            {gameData.status === 'submission' && (\r\n                currentPrompt.type === 'scenario_vote' ? (\r\n                    <div className=\"w-full text-center\">\r\n                        {!currentPlayer.hasSubmitted ? (\r\n                            <>\r\n                                <h3 className=\"text-2xl font-bold text-white mb-4\">What's your take?</h3>\r\n                                {isWritingCustom ? (\r\n                                    <div className=\"mb-4\">\r\n                                        <textarea\r\n                                            value={customScenarioAnswer}\r\n                                            onChange={(e) => setCustomScenarioAnswer(e.target.value)}\r\n                                            className=\"w-full p-3 rounded-lg bg-white text-gray-900 h-24\"\r\n                                            placeholder=\"Make it spicy...\"\r\n                                        ></textarea>\r\n                                        <button onClick={() => setIsWritingCustom(false)} className=\"text-cyan-300 hover:text-cyan-400 mt-2\">Back to choices</button>\r\n                                    </div>\r\n                                ) : (\r\n                                    <>\r\n                                        <div className=\"space-y-3 mb-6\">\r\n                                            {Object.entries(currentPrompt.choices).sort((a, b) => a[0].localeCompare(b[0])).map(([key, value]) => (\r\n                                                <button\r\n                                                    key={key}\r\n                                                    onClick={() => setSelectedChoice(key)}\r\n                                                    className={`w-full text-left p-4 rounded-xl shadow-md transition transform ${\r\n                                                        selectedChoice === key ? 'bg-blue-400 scale-105 ring-4 ring-blue-500 text-white' : 'bg-white hover:bg-gray-100 text-gray-900'\r\n                                                    }`}\r\n                                                >\r\n                                                    <span className=\"font-bold uppercase mr-3\">{key})</span>{value}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                        <button onClick={() => { setIsWritingCustom(true); setSelectedChoice(null); }} className=\"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full shadow-lg mb-4\">\r\n                                            ...or write your own answer\r\n                                        </button>\r\n                                    </>\r\n                                )}\r\n                                \r\n                                <button\r\n                                    onClick={handleSubmitChoice}\r\n                                    disabled={isWritingCustom ? !customScenarioAnswer.trim() : !selectedChoice}\r\n                                    className=\"w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50\"\r\n                                >\r\n                                    Submit Choice\r\n                                </button>\r\n                            </>\r\n                        ) : (\r\n                            <p className=\"text-2xl text-gray-200 animate-pulse\">Waiting for other players to submit their take...</p>\r\n                        )}\r\n                        <p className=\"text-gray-300 mt-4 text-lg\">\r\n                            Submitted: {submittedCount} / {playersWhoShouldSubmit.length}\r\n                        </p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"w-full max-w-lg mx-auto\">\r\n                        {!currentPlayer.hasSubmitted ? (\r\n                            <>\r\n                                {currentPrompt.type !== 'thisSoundsLike' && (\r\n                                    <>\r\n                                        <h3 className=\"text-xl font-bold text-white mb-4\">Your Hand:</h3>\r\n                                        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-6\">\r\n                                            {playerHand.map((card, index) => (\r\n                                                <button\r\n                                                    key={card + index}\r\n                                                    onClick={() => handleSelectCard(card)}\r\n                                                    className={`p-3 rounded-lg shadow-md h-32 text-sm text-gray-900 transition-transform transform hover:scale-105 ${selectedCard === card ? 'bg-cyan-300 ring-4 ring-cyan-500' : 'bg-white hover:bg-gray-100'}`}\r\n                                                >\r\n                                                    {card}\r\n                                                </button>\r\n                                            ))}\r\n                                            {(currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') && (\r\n                                                <button\r\n                                                    onClick={() => handleSelectCard(\"BLANK_CARD_SELECTED\")}\r\n                                                    className={`p-3 rounded-lg shadow-md h-32 text-sm transition-transform transform hover:scale-105 ${selectedCard === \"BLANK_CARD_SELECTED\" ? 'bg-yellow-300 ring-4 ring-yellow-500 text-gray-900' : 'bg-gray-200 hover:bg-gray-300 text-gray-900'}`}\r\n                                                >\r\n                                                    Write your own...\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </>\r\n                                )}\r\n                                {currentPrompt.type === 'thisSoundsLike' && (\r\n                                    <div className=\"mb-4\">\r\n                                        <h3 className=\"text-xl font-bold text-white mb-2\">1. Nominate a Player</h3>\r\n                                        <select\r\n                                            value={nominationData.nominatedPlayerId}\r\n                                            onChange={(e) => setNominationData(prev => ({ ...prev, nominatedPlayerId: e.target.value }))}\r\n                                            className=\"w-full p-3 rounded-lg bg-white text-gray-900\"\r\n                                        >\r\n                                            <option value=\"\">Select a player...</option>\r\n                                            {playersInGame.filter(p => p.id !== userId).map(p => (\r\n                                                <option key={p.id} value={p.id}>{p.name}</option>\r\n                                            ))}\r\n                                        </select>\r\n                                        <h3 className=\"text-xl font-bold text-white mb-2 mt-4\">2. Justify your nomination</h3>\r\n                                        <textarea\r\n                                            value={nominationData.justification}\r\n                                            onChange={(e) => setNominationData(prev => ({ ...prev, justification: e.target.value }))}\r\n                                            placeholder=\"Why does this sound like them?\"\r\n                                            className=\"w-full p-3 rounded-lg bg-white text-gray-900 h-24\"\r\n                                        ></textarea>\r\n                                    </div>\r\n                                )}\r\n                                {selectedCard === \"BLANK_CARD_SELECTED\" && currentPrompt.type !== 'thisSoundsLike' && (\r\n                                    <div className=\"mb-4\">\r\n                                        <h3 className=\"text-xl font-bold text-white mb-2\">Write Your Custom Answer</h3>\r\n                                        <textarea\r\n                                            value={customAnswer}\r\n                                            onChange={(e) => setCustomAnswer(e.target.value)}\r\n                                            className=\"w-full p-3 rounded-lg bg-white text-gray-900 h-24\"\r\n                                            placeholder=\"Make it good!\"\r\n                                        ></textarea>\r\n                                    </div>\r\n                                )}\r\n                                <button\r\n                                    onClick={handleSubmitAnswer}\r\n                                    className=\"w-full bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                    disabled={((currentPrompt.type === 'fill' || currentPrompt.type === 'image_judgment') && (!selectedCard || (selectedCard === \"BLANK_CARD_SELECTED\" && !customAnswer.trim()))) || (currentPrompt.type === 'thisSoundsLike' && (!nominationData.nominatedPlayerId || !nominationData.justification.trim()))}\r\n                                >\r\n                                    Submit Answer\r\n                                </button>\r\n                            </>\r\n                        ) : (\r\n                            <p className=\"text-2xl text-gray-200 animate-pulse\">Waiting for other players to submit...</p>\r\n                        )}\r\n                        <p className=\"text-gray-300 mt-4 text-lg\">\r\n                            Submitted: {submittedCount} / {playersWhoShouldSubmit.length}\r\n                        </p>\r\n                    </div>\r\n                )\r\n            )}\r\n\r\n            {gameData.status === 'voting' && (\r\n                currentPrompt.type === 'scenario_vote' ? (\r\n                    <div className=\"w-full text-center\">\r\n                        <h3 className=\"text-2xl font-bold text-white mb-4\">Judge Their Takes!</h3>\r\n                        <p className=\"text-gray-300 mb-6\">Give a ❤️ for a relationship goal or a 🚩 for a red flag.</p>\r\n                        <div className=\"space-y-4 mb-6\">\r\n                            {shuffledPlayersToVoteOn.map(player => { // Use shuffled players\r\n                                const choiceValue = gameData.playerChoices[player.id];\r\n                                const choiceText = choiceValue ? (currentPrompt.choices[choiceValue] || choiceValue) : \"No choice submitted.\";\r\n                                const hearts = gameData.votes?.[player.id]?.hearts || [];\r\n                                const redFlags = gameData.votes?.[player.id]?.redFlags || [];\r\n                                const hasVotedHeart = hearts.includes(userId);\r\n                                const hasVotedFlag = redFlags.includes(userId);\r\n\r\n                                return (\r\n                                    <div key={player.id} className=\"bg-white bg-opacity-20 rounded-xl p-4 text-left\">\r\n                                        <p className=\"text-gray-200 mb-3 text-xl italic\">\"{choiceText}\"</p>\r\n                                        <div className=\"flex justify-end items-center space-x-3\">\r\n                                            <button\r\n                                                onClick={() => handleScenarioVote(player.id, 'hearts')}\r\n                                                disabled={hasVotedHeart || hasVotedFlag || currentPlayer.hasVoted}\r\n                                                className={`px-4 py-2 rounded-full font-bold text-2xl transition transform hover:scale-110 disabled:opacity-50 ${hasVotedHeart ? 'bg-pink-400' : 'bg-gray-300 hover:bg-pink-300'}`}\r\n                                            >\r\n                                                ❤️\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleScenarioVote(player.id, 'redFlags')}\r\n                                                disabled={hasVotedHeart || hasVotedFlag || currentPlayer.hasVoted}\r\n                                                className={`px-4 py-2 rounded-full font-bold text-2xl transition transform hover:scale-110 disabled:opacity-50 ${hasVotedFlag ? 'bg-red-500' : 'bg-gray-300 hover:bg-red-400'}`}\r\n                                            >\r\n                                                🚩\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                        {!currentPlayer.hasVoted && (\r\n                            <button onClick={handleLockInVotes} className=\"w-full bg-gradient-to-r from-green-500 to-lime-400 text-white font-bold py-4 px-8 rounded-full shadow-lg\">\r\n                                Lock In Your Votes\r\n                            </button>\r\n                        )}\r\n                        <p className=\"text-gray-300 mt-4 text-lg\">\r\n                            Voted: {votersCount} / {playersInGame.length}\r\n                        </p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"w-full text-center\">\r\n                        <h3 className=\"text-2xl font-bold text-white mb-4\">Vote for your favorite!</h3>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\r\n                            {submittedAnswers.map(sub => (\r\n                                <div key={sub.id} className=\"relative bg-white bg-opacity-20 rounded-xl p-4 flex flex-col justify-between\">\r\n                                    <p className=\"text-white text-lg font-semibold mb-4\">\"\r\n                                        {typeof sub.answer === 'object' && sub.answer !== null ? sub.answer.justification : sub.answer}\r\n                                    \"</p>\r\n                                    <div className=\"text-right\">\r\n                                        <button\r\n                                            onClick={() => handleVote(sub.id)}\r\n                                            disabled={currentPlayer.hasVoted || sub.playerId === userId}\r\n                                            className={`bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-300 disabled:opacity-50 ${sub.playerId === userId ? 'cursor-not-allowed bg-gray-400 hover:from-gray-400 hover:to-gray-400' : ''}`}\r\n                                            title={sub.playerId === userId ? \"You can't vote for your own answer\" : \"Vote for this answer\"}\r\n                                        >\r\n                                            {sub.playerId === userId ? \"Your Answer\" : \"Vote\"}\r\n                                        </button>\r\n                                        {gameData.votes[sub.id] && <span className=\"ml-4 text-lg font-bold text-white\">{(gameData.votes[sub.id] || []).length}</span>}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        {!currentPlayer.hasVoted && (\r\n                            <p className=\"text-lg text-gray-300\">Choose the funniest or most fitting answer!</p>\r\n                        )}\r\n                        <p className=\"text-gray-300 mt-4 text-lg\">\r\n                            Voted: {votersCount} / {playersInGame.length}\r\n                        </p>\r\n                    </div>\r\n                )\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// LeaderboardPage Component\r\nconst LeaderboardPage = ({ gameData, userId, gameId, showMessage, handleNextRound }) => {\r\n    const isHost = gameData.hostId === userId;\r\n    const players = Object.values(gameData.players).sort((a, b) => b.score - a.score);\r\n    const currentPrompt = gameData.prompts[gameData.currentRound - 1]; // Access the correct prompt\r\n\r\n    const votersCount = players.filter(p => p.hasVoted).length;\r\n\r\n    const winningSubmissions = (gameData.currentWinningSubmission || []).map(id => gameData.submittedAnswers[id]).filter(Boolean);\r\n    const winnerNames = winningSubmissions.map(sub => gameData.players[sub.playerId]?.name).join(', ');\r\n\r\n    return (\r\n        <div className=\"text-center p-4\">\r\n            <h2 className=\"text-4xl font-bold text-white mb-6 animate-fade-in-down\">Round {gameData.currentRound} Results</h2>\r\n            {/* Show the current question/prompt at the top */}\r\n            {currentPrompt && (\r\n                <div className=\"mb-8 bg-white bg-opacity-20 rounded-xl p-4 max-w-2xl mx-auto\">\r\n                    <p className=\"text-lg md:text-2xl font-bold text-yellow-200 mb-2\">Question:</p>\r\n                    <p className=\"text-xl md:text-2xl text-white\">{currentPrompt.text}</p>\r\n                </div>\r\n            )}\r\n\r\n            {currentPrompt.type === 'scenario_vote' && gameData.roundResults ? (\r\n                 <div className=\"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 mb-8 w-full max-w-2xl mx-auto\">\r\n                    <h3 className=\"text-2xl font-bold text-cyan-300 mb-4\">How did everyone do?</h3>\r\n                    <div className=\"space-y-4\">\r\n                        {players.map(player => {\r\n                            const result = gameData.roundResults[player.id];\r\n                            if (!result) return null;\r\n                            const choiceValue = result.choiceKey;\r\n                            const choiceText = currentPrompt.choices[choiceValue] || choiceValue;\r\n                            return (\r\n                                <div key={player.id} className=\"text-left p-4 bg-gray-900 bg-opacity-50 rounded-lg\">\r\n                                    <p className=\"font-bold text-white text-xl\">{player.name}'s take:</p>\r\n                                    <p className=\"text-gray-300 italic my-2\">\"{choiceText}\"</p>\r\n                                    <div className=\"flex justify-end items-center space-x-4 text-xl\">\r\n                                        <span className=\"text-pink-400 font-bold\">❤️ {result.hearts}</span>\r\n                                        <span className=\"text-red-500 font-bold\">🚩 {result.redFlags}</span>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 mb-8 w-full max-w-2xl mx-auto\">\r\n                    <h3 className=\"text-2xl font-bold text-cyan-300 mb-2\">Winning Answer{winningSubmissions.length > 1 ? 's' : ''}</h3>\r\n                    {winningSubmissions.length > 0 ? (\r\n                        <>\r\n                            {winningSubmissions.map(sub => (\r\n                                <p key={sub.id} className=\"text-white text-xl font-semibold bg-gray-900 bg-opacity-50 rounded-md p-4 my-2\">\"\r\n                                    {typeof sub.answer === 'object' && sub.answer !== null ? sub.answer.justification : sub.answer}\r\n                                \"</p>\r\n                            ))}\r\n                            <p className=\"text-gray-300 mt-2 text-lg\">Submitted by: <span className=\"font-bold text-white\">{winnerNames}</span> (+1 point)</p>\r\n                        </>\r\n                    ) : (\r\n                        <p className=\"text-white text-xl font-semibold\">No winning answer this round. Everyone gets to keep their dignity.</p>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n\r\n            <div className=\"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 w-full max-w-md mx-auto\">\r\n                <h3 className=\"text-3xl font-bold text-white mb-4\">Leaderboard</h3>\r\n                {gameData.category === \"Red Flag or Relationship Goal\" ? (\r\n                    <ul className=\"space-y-3 mb-8\">\r\n                        {players.map((player, index) => (\r\n                            <li key={player.id} className={`flex items-center justify-between p-4 rounded-xl shadow-md text-white ${\r\n                                index === 0 ? 'bg-yellow-400 bg-opacity-50' : 'bg-white bg-opacity-30'\r\n                            }`}>\r\n                                <span className=\"text-lg font-semibold\">{player.name}</span>\r\n                                <div className=\"flex items-center space-x-4 text-lg\">\r\n                                    <span className=\"text-pink-400 font-bold\">❤️ {player.totalHearts || 0}</span>\r\n                                    <span className=\"text-red-500 font-bold\">🚩 {player.totalRedFlags || 0}</span>\r\n                                </div>\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n                ) : (\r\n                    <ul className=\"space-y-3 mb-8\">\r\n                        {players.map((player, index) => (\r\n                            <li key={player.id} className={`flex items-center justify-between p-4 rounded-xl shadow-md ${\r\n                                index === 0 ? 'bg-yellow-300 text-gray-900 font-bold text-xl' : 'bg-white bg-opacity-30 text-white'\r\n                            }`}>\r\n                                <div className=\"flex items-center space-x-4\">\r\n                                    <span className=\"text-lg font-bold\">{index + 1}.</span>\r\n                                    <span className=\"text-lg\">{player.name}</span>\r\n                                </div>\r\n                                <span className=\"text-lg font-bold\">{player.score} pts</span>\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n                )}\r\n                {isHost && (\r\n                    <button\r\n                        onClick={handleNextRound}\r\n                        className=\"w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\"\r\n                    >\r\n                        {gameData.currentRound < gameData.maxRounds ? 'Next Round' : 'Show Final Results'}\r\n                    </button>\r\n                )}\r\n                {!isHost && (\r\n                    <p className=\"text-xl text-gray-300 italic\">Waiting for host to continue...</p>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// WinnerPage Component\r\nconst WinnerPage = ({ gameData, userId, onPlayAgain, showMessage }) => {\r\n    // Add ad logic here\r\n    const [showAd, setShowAd] = useState(true);\r\n    const adIndex = 0; // Always show the first ad, or randomize if you want\r\n    const [analyticsUpdated, setAnalyticsUpdated] = useState(false);\r\n\r\n    const handleCloseAd = async () => {\r\n        setShowAd(false);\r\n        // Analytics: Only the host should update analytics\r\n        if (gameData.hostId === userId && !analyticsUpdated) {\r\n            try {\r\n                // Increment global games played\r\n                const statsRef = doc(db, `artifacts/${appId}/public/data/analytics`, 'globalStats');\r\n                await updateDoc(statsRef, { gamesPlayed: increment(1) }).catch(async (err) => {\r\n                    if (err.code === 'not-found') {\r\n                        await setDoc(statsRef, { gamesPlayed: 1 });\r\n                    }\r\n                });\r\n                // Increment gamesPlayed and set lastPlayed for all players\r\n                for (const player of Object.values(gameData.players)) {\r\n                    const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, player.id);\r\n                    await updateDoc(playerStatsRef, { gamesPlayed: increment(1), lastPlayed: serverTimestamp() }).catch(async (err) => {\r\n                        if (err.code === 'not-found') {\r\n                            await setDoc(playerStatsRef, { gamesPlayed: 1, lastPlayed: serverTimestamp(), name: player.name });\r\n                        }\r\n                    });\r\n                }\r\n                // Increment wins for the winner(s)\r\n                let winners = [];\r\n                if (gameData.category === \"Red Flag or Relationship Goal\") {\r\n                    const players = Object.values(gameData.players);\r\n                    let minRatio = Math.min(...players.map(p => ((p.totalRedFlags || 0) / (((p.totalHearts || 0) + (p.totalRedFlags || 0)) || 1))));\r\n                    winners = players.filter(p => ((p.totalRedFlags || 0) / (((p.totalHearts || 0) + (p.totalRedFlags || 0)) || 1)) === minRatio);\r\n                } else {\r\n                    const players = Object.values(gameData.players);\r\n                    let maxScore = Math.max(...players.map(p => p.score || 0));\r\n                    winners = players.filter(p => (p.score || 0) === maxScore);\r\n                }\r\n                for (const winner of winners) {\r\n                    const playerStatsRef = doc(db, `artifacts/${appId}/public/data/playerStats`, winner.id);\r\n                    await updateDoc(playerStatsRef, { wins: increment(1) }).catch(async (err) => {\r\n                        if (err.code === 'not-found') {\r\n                            await setDoc(playerStatsRef, { wins: 1, name: winner.name });\r\n                        }\r\n                    });\r\n                }\r\n                setAnalyticsUpdated(true);\r\n            } catch (err) {\r\n                console.error('Error updating analytics:', err);\r\n            }\r\n        }\r\n    };\r\n\r\n    // Add a guard clause for gameData\r\n    if (!gameData || !gameData.players) {\r\n        return <div className=\"text-center p-4 text-white\">Loading final results...</div>;\r\n    }\r\n\r\n    const players = Object.values(gameData.players).sort((a, b) => {\r\n        if (gameData.category === \"Red Flag or Relationship Goal\") {\r\n             const aRatio = ((a.totalRedFlags || 0) / ((a.totalHearts || 0) + (a.totalRedFlags || 0) || 1));\r\n             const bRatio = ((b.totalRedFlags || 0) / ((b.totalHearts || 0) + (b.totalRedFlags || 0) || 1));\r\n             return aRatio - bRatio; // Sort by lowest red flag ratio\r\n        }\r\n        return (b.score || 0) - (a.score || 0); // Default score sort\r\n    });\r\n    \r\n    const isHost = gameData.hostId === userId;\r\n\r\n    const handleDeleteGame = async () => {\r\n        showMessage(\"Are you sure you want to delete this game? This action cannot be undone.\", async () => {\r\n            try {\r\n                if (gameData.id) {\r\n                    await deleteDoc(doc(db, `artifacts/${appId}/public/data/games`, gameData.id));\r\n                    onPlayAgain(); // Go back to home page after deletion\r\n                } else {\r\n                    console.error(\"Game ID is undefined, cannot delete.\");\r\n                    showMessage(\"Failed to delete game: Game ID missing.\");\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error deleting game:\", error);\r\n                showMessage(\"Failed to delete game. Please try again.\");\r\n            }\r\n        });\r\n    };\r\n\r\n    const getPlayerTitleAndDescription = (player) => {\r\n        if(gameData.category !== \"Red Flag or Relationship Goal\") {\r\n            return { title: `Score: ${player.score}`, description: \"Played a different game mode.\" };\r\n        }\r\n\r\n        const { totalHearts, totalRedFlags } = player;\r\n        const totalVotes = (totalHearts || 0) + (totalRedFlags || 0);\r\n\r\n        if (totalVotes === 0) {\r\n            return { title: \"Mystery Card\", description: \"Not enough votes to get a read. Are you an enigma or just quiet?\" };\r\n        }\r\n\r\n        const redFlagPercentage = (totalRedFlags / totalVotes) * 100;\r\n        const rating = Math.round(redFlagPercentage / 10) * 10;\r\n\r\n        return RED_FLAG_TITLES[rating] || { title: \"Calculation Error\", description: \"Something went wrong here.\"};\r\n    };\r\n\r\n    return (\r\n        <div className=\"text-center p-4\">\r\n            {/* Full-page ad overlay at end of game */}\r\n            {showAd && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90\">\r\n                    <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full flex flex-col items-center relative\">\r\n                        <img src={POPUP_ADS[adIndex].image} alt=\"Kriya Botanicals\" className=\"w-48 h-48 object-cover rounded-xl mb-4 shadow-lg\" />\r\n                        <h2 className=\"text-3xl font-extrabold text-green-700 mb-2\">{POPUP_ADS[adIndex].title}</h2>\r\n                        <p className=\"text-lg text-gray-800 mb-6\">{POPUP_ADS[adIndex].description}</p>\r\n                        <button\r\n                            onClick={handleCloseAd}\r\n                            className=\"bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\"\r\n                        >\r\n                            Continue\r\n                        </button>\r\n                        <span className=\"absolute top-2 right-4 text-xs text-gray-400\">Sponsored</span>\r\n                    </div>\r\n                </div>\r\n            )}\r\n            {!showAd && (\r\n            <>\r\n            <h2 className=\"text-5xl font-bold text-yellow-300 mb-4 animate-bounce\">Game Over!</h2>\r\n            {players.length > 0 ? <h3 className=\"text-3xl text-white mb-8\">And the winner is... <span className=\"font-bold text-cyan-400\">{players[0].name}!</span></h3> : null}\r\n\r\n            <div className=\"bg-white bg-opacity-20 backdrop-blur-md rounded-xl shadow-lg p-6 w-full max-w-2xl mx-auto\">\r\n                <h4 className=\"text-2xl font-bold text-white mb-4\">Final Standings</h4>\r\n                 <ul className=\"space-y-4\">\r\n                    {players.map((player, index) => {\r\n                        const { title, description } = getPlayerTitleAndDescription(player);\r\n                        return (\r\n                            <li key={player.id} className=\"text-left p-4 bg-gray-900 bg-opacity-50 rounded-lg text-white\">\r\n                                <div className=\"flex justify-between items-center mb-1\">\r\n                                    <span className={`text-xl font-bold ${index === 0 ? 'text-yellow-400' : ''}`}>{index + 1}. {player.name}</span>\r\n                                    <span className=\"text-lg font-semibold text-cyan-300 text-right\">{title}</span>\r\n                                </div>\r\n                                <p className=\"text-sm text-gray-300 italic\">\"{description}\"</p>\r\n                            </li>\r\n                        );\r\n                    })}\r\n                </ul>\r\n            </div>\r\n\r\n            {isHost && (\r\n                <>\r\n                    <button\r\n                        onClick={onPlayAgain}\r\n                        className=\"w-full bg-gradient-to-r from-green-500 to-lime-400 hover:from-green-600 hover:to-lime-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 mb-4\"\r\n                    >\r\n                        Play Again!\r\n                    </button>\r\n                    <button\r\n                        onClick={handleDeleteGame}\r\n                        className=\"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105\"\r\n                    >\r\n                        Delete This Game\r\n                    </button>\r\n                </>\r\n            )}\r\n            {!isHost && (\r\n                <p className=\"text-xl text-gray-300 italic\">Ask the host to start a new game!</p>\r\n            )}\r\n            </>) }\r\n        </div>\r\n    );\r\n};\r\n\r\n// Utility function to shuffle an array (Fisher-Yates)\r\nconst shuffleArray = (array) => {\r\n    let currentIndex = array.length, randomIndex;\r\n    while (currentIndex !== 0) {\r\n        randomIndex = Math.floor(Math.random() * currentIndex);\r\n        currentIndex--;\r\n        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\r\n    }\r\n    return array;\r\n};\r\n\r\n// Utility function to get a random prompt that hasn't been played yet\r\nconst getRandomPrompt = (promptList, history) => {\r\n    // History should contain the 'text' of previously played prompts\r\n    const availablePrompts = promptList.filter(p => !history.includes(p.text));\r\n    if (availablePrompts.length === 0) {\r\n        console.warn(\"All prompts for this category have been used. Reshuffling prompts for this round.\");\r\n        return promptList[Math.floor(Math.random() * promptList.length)]; // If all used, pick randomly from full list\r\n    }\r\n    const randomIndex = Math.floor(Math.random() * availablePrompts.length);\r\n    return availablePrompts[randomIndex];\r\n};\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}